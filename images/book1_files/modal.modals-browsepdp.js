/*! BARNES-BUILDER 2016-11-18 */
BN.Modal=BN.Modal||{},BN.Modal.SingleInstance=function(a,b,c,d){this.data=b,this.events={},this.closeEvents={back:[],button:[],method:[],all:[]},Modal.call(this,a,b,c,d)},BN.Modal.SingleInstance.prototype=Modal.prototype,BN.Modal.SingleInstance.prototype.isModalAlreadyOpen=function(){var a,b,c;if(this.openModals)for(var d in this.openModals)if(a=this.openModals[d],a&&a.data&&(this.data&&(b=this.data.target),a.data&&(c=a.data.target),b&&c&&$(b).is(c)))return!0;return!1},$.extend(!0,BN.Modal.SingleInstance,Modal),BN.Modal.Base=BN.Modal.Base||Extend(function(){var a=function(){this.__originalArguments=Array.prototype.slice.call(arguments,0);var a=this;"ontouchstart"in document.documentElement?($("input").focusout(),$("input").blur(),$("input[type=hidden]").focus(),console.log("touch device")):console.log("not touch"),consoleLog("Instantiating BN.Modal.Base"),this.on("display",function(){window.html5.shivDocument(document);for(var a=["login","register","reset-password-email","reset-password","change-password"],b=!1,c=this.tplName,d=this.productName||BN.Modal.Base.prototype.getProductNameByModal(),e=this.data?this.data["work-id"]:"work-id unavailable",f=0;f<a.length;f++)this.tplName===a[f]&&(b=!0);b||"undefined"!=typeof s_setP&&updateAnalyticsPageName(c,d,e)}),$(document.body).addClass("pure-is-open"),this.closeEvents.back=this.closeEvents.back||[],this.closeEvents.back.push(function(){for(var a in Modal.openModals)if(Modal.openModals.hasOwnProperty(a)){var b=null!==Modal.openModals[a].options.tplParams?Modal.openModals[a].options.tplParams.tplName:Modal.openModals[a].tplName,c=Modal.openModals[a].productName||BN.Modal.Base.prototype.getProductNameByModal(),d=Modal.openModals[a].data?Modal.openModals[a].data["work-id"]:"work-id unavailable";"undefined"!=typeof s_setP&&updateAnalyticsPageName(b,c,d)}}),this.closeEvents.method=this.closeEvents.method||[],this.closeEvents.method.push(function(){var a=this.data;if(a&&"undefined"!=typeof a.frameUrl&&this.parent){var b=this.parent,c=null!==b.options.tplParams?b.options.tplParams.tplName:b.tplName;"undefined"!=typeof s_setP&&updateAnalyticsPageName(c)}}),this.closeEvents.all=this.closeEvents.all||[],this.closeEvents.all.push(function(){var b=!1;for(var c in Modal.openModals)if(Modal.openModals.hasOwnProperty(c)){b=!0;break}b||(a.productName="",$(document.body).removeClass("pure-is-open"),"undefined"!=typeof s_setP&&updateAnalyticsPageName())}),this.closeEvents.all.push(function(){var b;a.data&&a.data.target?(b=$(a.data.target),consoleLog("returning focus to ",b),b.focus()):consoleLog("can't return focus to the modal-opening element, as it could not be found")}),this.initFocus()};return a.prototype={defaultOptions:{tplDir:SITE_ROOT+"/modals/",tplExt:".jsp",overlayClose:"all",css:{position:"fixed"},modalIsScrollable:!0,useCache:!1},$spinner:null,invisibleOverlay:!1,__cycle:function(){var a=this.thisConstructor,b=a.prototype,c=Array.prototype.slice.call(this.__originalArguments,0),d=this;this.Close();for(var e in b)d[e]=b[e];a.apply(d,c)},initGenericView:function(){BN.Validate.Listen($(this.modal).find("form")),document.body.className.indexOf("lt-ie9")>-1&&!$(".tabgroup span[id]").length&&(consoleLog("IE8 Detected!"),consoleLog("Setting Timeout"),setTimeout(function(){consoleLog("Timeout Executing");var a=document.getElementById("selectivizrScript"),b=a.getAttribute("src");consoleLog("Executing selectivizr..."),consoleLog(jQuery.getScript(b))},500)),$("select").selectBox(),this.on("display",function(){consoleLog("Styling Select Boxes"),$("#state").length>0&&autofillStateFix(),$(this.modal).find("a.selectBox-dropdown").each(function(){var a=$(this),b=a.parent().parent(),c=b.find("label:first"),d=b.find("select"),e=b.find(".selectBox-dropdown-menu"),f=a.find(".selectBox-label"),g=d.attr("id");d.attr("aria-hidden","true"),f.attr("id",g+"-button-label"),e.attr({id:g+"-option-list",role:"listbox"}),e.find("li").each(function(a){$(this).attr("id",g+"-option-"+a)}),""!==g&&c.attr({"for":g+"-replacement",id:g+"-label"}),a.attr({id:g+"-replacement",role:"combobox","aria-labelledby":g+"-label "+g+"-button-label","aria-expanded":"false"}).bind("keydown",function(b){switch(b.which){case 9:case 13:case 27:"true"==a.attr("aria-expanded")||e.not(":visible")?(a.attr("aria-expanded","false").removeAttr("aria-activedescendant"),e.attr("aria-hidden","true")):(e.attr("aria-hidden","false"),a.attr("aria-expanded","true").attr("aria-activedescendant",c));break;case 37:case 38:case 39:case 40:"false"==a.attr("aria-expanded")&&(a.attr("aria-expanded","true"),e.attr("aria-hidden","false"));var c=e.find(".selectBox-selected:first").attr("id");a.attr("aria-activedescendant",c)}})})}),$(this.modal).find(".styled-radio").attr("role","radio"),$(this.modal).find(".styled-checkbox").attr("role","checkbox")},initFocus:function(){var a=this;this.on("display",function(){a.suppressAutoTabindex||(a.addTabIndex(),a.initTabIndex()),a.initFocusImmediately()})},initFocusInParent:function(){var a,b;if(this.parent&&this.parent.displayed)if(a=this.parent.modal,b=$(a).find("iframe"),b.length&&this.parent.data.frameUrl)try{$.postMessage({type:"initFocus",focusSelector:this.data&&this.data.targetSelector},this.parent.data.frameUrl,b.first().get(0).contentWindow)}catch(c){consoleLog("an error occurred trying to give focus to parent modal containing iframe",c),this.parent.initFocusImmediately()}else this.parent.initFocusImmediately()},__displayDom:function(){var a=this;Modal.prototype.__displayDom.apply(this,arguments),this.closeEvents.all.push(function(){a.initFocusInParent()})},initOverlay:function(){var a=document.createElement("div");return 1==this.invisibleOverlay?(a.style.backgroundColor="#ffffff",a.style.opacity=0,a.style.filter="alpha(opacity=0);"):(a.style.backgroundColor="#000000",a.style.opacity=.5,a.style.filter="alpha(opacity=50);"),a.style.height="100%",a.style.width="100%",a.style.position="fixed",a.style.top="0px",a.style.left="0px",a},useInvisibleOverlay:function(){this.invisibleOverlay=!0},displaySpinner:function(){consoleLog("Displaying spinner...");var a=$(this.modal),b=a.find("header").first(),c={top:"0px"};return b.length>0&&(consoleLog("Adjusting top to compensate for header"),c.top=b.outerHeight()+"px"),consoleLog("Building spinner"),this.$spinner=$("<div/>").addClass("spinner").css(c),consoleLog("Appending spinner to modal DOM"),this.$spinner.appendTo(a),this.$spinner.focus(),this.$spinner},hideSpinner:function(){return $(this.modal).find(".spinner").remove()},initForm:function(a){var b=this,c=$(this.modal).find('form.uxhr,form[action*="xhr"]');consoleLog("Attaching uXHR to form",c),BN.uXHR.Form.apply(c),consoleLog("Listening for Errors"),c.on("amplifiFormError",function(a,c,d,e,f){var g=f.items;consoleError("Unsuccessful Form Submission: Server's response indicated errors occurred"),consoleLog(g),BN.Validate.DisplayErrors(this,g),b.$spinner.remove()}).on("amplifiFormBeforeSubmit",function(){consoleLog("Calling displaySpinner"),b.hideSpinner(),b.displaySpinner()}).on("amplifiFormSuccess",function(d,e){var f=b.data,g=window.location.toString().split("#")[0];if(a===!1||null!=f&&f.redirect===!1)return void consoleLog("Success!");null!=e&&void 0!=e&&e instanceof Object&&e.redirectSuccessUrl&&""!=e.redirectSuccessUrl?g=e.redirectSuccessUrl:null!=f&&void 0!=f&&f instanceof Object&&f.redirectSuccessUrl&&""!=f.redirectSuccessUrl?g=f.redirectSuccessUrl:null!=e&&void 0!=e&&e instanceof Object&&null!=e.data&&e.data.brierleyLandingRedirect&&null!=e.data.brierleyLandingRedirectURL&&(g=e.data.brierleyLandingRedirectURL);var h=null,i=(h=c.find('input[name="modalRedirect"]')).length>0;if(i){consoleLog("Success! Redirecting modal to "+h.val());{var j=b.getContructorFromString(h.val());new j(null,null,null,b)}}else{consoleLog("Success! Redirecting page to "+g);var k=g;"undefined"!=typeof BN_EXTERNAL_DOMAIN_PREFIXED&&(k=BN_EXTERNAL_DOMAIN_PREFIXED+k),window.location=k}}).on("firstinvalid",function(){b.$spinner&&b.$spinner.remove()}),$(document).on("click","#guestCheckoutBtn",function(){$("#checkoutForm").submit()}),$(this.modal).find("select").selectBox()},clearForm:function(a){var b=$(a),c="input[type='text'],input[type='email'],input[type='tel'],input[type='password'],input[type='number'],input[type='file'],select,textarea";return b.find(c).val(""),b.find('input[type="radio"], input[type="checkbox"]').removeAttr("checked").removeAttr("selected"),b}},a}(),BN.Modal.SingleInstance,!0),BN.Modal.Base.prototype.tabbableSelector=":tabbable:not([tabindex=-1]),[data-icon=plus-expand]",BN.Modal.Base.prototype.initTabIndex=function(a){var b=a||$(this.modal),c="*[tabindex]:not([tabindex=-1])",d=b.find(c),e=d.length?parseInt(d.last().attr("tabindex")):-1;b.on("keydown",c,function(a){var c,d,f=$(this),g=f.attr("tabindex");9==a.keyCode&&(a.preventDefault(),d=parseInt(g)+(a.shiftKey?-1:1),1>d&&(d=e),c=b.find("*[tabindex="+d+"]"),c.length||(c=b.find("*[tabindex=1]")),c.each(function(){return"none"!=$(this).css("display")?(this.focus(),!1):void 0}))})},BN.Modal.Base.prototype.removeTabIndex=function(a){var b=a?a.$parent?a.$parent:a.selector?$(this.modal).find(a.selector):$(this.modal):$(this.modal);b.find("[tabindex]").removeAttr("tabindex")},BN.Modal.Base.prototype.addTabIndex=function(a){var b=this,c=a?a.$parent?a.$parent:a.selector?$(this.modal).find(a.selector):$(this.modal):$(this.modal),d=a&&a.inputSelectors?a.inputSelectors:this.tabbableSelector+(this.addToTabindex?","+this.addToTabindex:""),e=c.find(d),f=1;consoleLog("addTabIndex => $inputs = ",e),e.each(function(){var a=$(this);b.excludeFromTabindex&&a.is(b.excludeFromTabindex)||a.attr("tabindex",f++)})},BN.Modal.Base.prototype.initFocusImmediately=function(a,b){var c,d,e=a||$(this.modal),f=!1,g=["input[autofocus]","input[type=text]:visible:first",this.tabbableSelector],h=function(b){b&&b.length>0&&(consoleLog("bn.base.js: initFocusImmediately",b),consoleLog("bn.base.js: initFocusImmediately parent",a),setTimeout(function(){b.focus(),b.first().get(0).focus()},0),consoleLog("modal opened .. giving focus to ",b.first()),f=!0)};b=b||this.initFocusSelector,b&&h(b instanceof jQuery?b:e.find(b)),f||$.each(g,function(a,b){return c=e.find(b),d=c.first(),h(d),f?(d.is("a.close-modal")&&c.length>1&&h(c.eq(1)),!1):void 0}),f||consoleLog("modal opened ... couldn't find focusable element")},BN.Modal.Base.prototype.getProductNameByURL=function(a){var b="undefined"!=typeof a?a.indexOf("/w/"):!1;if("undefined"==typeof a||-1===b)return!1;var c=a.substring(b+3),d=c.indexOf("/"),e=c.substring(0,d).replace(/-/g," ");this.productName=e},BN.Modal.Base.prototype.getProductNameByModal=function(){for(var a in Modal.openModals)if(Modal.openModals.hasOwnProperty(a)){if("undefined"==typeof Modal.openModals[a].productName)continue;return Modal.openModals[a].productName}},BN.Modal=BN.Modal||{},BN.Modal.Confirm=BN.Modal.Confirm||Extend(function(){var a=function(a,b){this.data=b,consoleLog("Instantiating BN.Modal.Confirm"),consoleLog("Using "+(a||this.tplName)+" template")};return a.prototype={tplName:"confirm",initView:function(){var a=this.data,b=this,c=$(this.modal);if(a&&(a.title&&"string"==typeof a.title&&c.find("#dialog-title").text(a.title),a.message)){var d=c.find("ul").first(),e=d.find("li").first().clone().html("");d.find("li").remove(),e.append(a.message),d.append(e),c.on("click","#confirmTextbookAction",function(c){var d=a.parent,e=d.find(".confirm-action");c.preventDefault(),b.Close(),e.prop("disabled")||(d.submit(),e.attr("disabled",!0))})}}},a}(),BN.Modal.Base,!0),BN.Modal.External=BN.Modal.External||{};var externalHref="";BN.Modal.External.Link=BN.Modal.External.Link||Extend(function(){var a=function(a,b){this.data=b,consoleLog("Instantiating BN.Modal.External.Link")};return a.prototype={tplName:"external-link",defaultOptions:{tplDir:SITE_ROOT+"/modals/",useCache:!1},initView:function(){var a=this.data,b=$(this.modal),c=$(a.target),d=c.attr("href")||"";this.on("display",function(){(""!=a["modal-title"]||"undefined"!=a["modal-title"])&&b.find("#dialog-title").text(a["modal-title"]),""!=a["modal-width"]&&"undefined"!=a["modal-width"]&&b.find("iframe").attr("width",a["modal-width"]),""!=a["modal-height"]&&"undefined"!=a["modal-height"]&&b.find("iframe").attr("height",a["modal-height"]),""!=a["modal-scrolling"]&&"undefined"!=a["modal-scrolling"]&&b.find("iframe").attr("scrolling",a["modal-scrolling"]),b.find("iframe").attr("src",d)})}},a}(),BN.Modal.Base,!0),BN.Modal=BN.Modal||{},BN.Modal.Success=BN.Modal.Success||Extend(function(){var a=function(a,b){this.data=b,consoleLog("Instantiating BN.Modal.Success")};return a.prototype={tplName:"success",initView:function(){var a=this.data,b=$(this.modal);if(a&&(a.title&&"string"==typeof a.title&&b.find("#dialog-title").html(a.title),a.messages)){var c=b.find("ul").first(),d=c.find("li").first().clone().html(""),e=$("<span/>");c.find("li").remove(),c.addClass("modal-success-message");for(var f in a.messages)if(a.messages.hasOwnProperty(f)){var g=a.messages[f],h=d.clone();switch(g.type){case"success":h.append(e.clone())}0==f&&h.addClass("success-first"),h.append(g.message),c.append(h)}a.onclose&&this.closeEvents.all.push(a.onclose),a.target&&a.target.blur()}}},a}(),BN.Modal.Base,!0);;/*! BARNES-BUILDER 2016-11-18 */
function updateIndexes(){$(".kids-container ul:first li").each(function(a){var b=$(this);b.attr("id","item_"+a);var c=b.find("a").attr("href"),d=c.split("?")[0],e=c.split("?")[1];b.find("a").attr("href",d+"?"+e.split("&")[0]+"&index="+a)})}BN.Modal.Account=BN.Modal.Account||{},BN.Modal.Account.Base=BN.Modal.Account.Base||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Account.Base")};return a.prototype={defaultOptions:{tplDir:SITE_ROOT+"/modals/account/"},initFrameForm:function(a){var b=this;$(window).on("amplifiFrameFormSuccess",function(c,d){var e=b.data,f=window.location.toString().split("#")[0];if(a===!1||e.redirect===!1)return loadDynamicHeaderElements(),void consoleLog("Success!");null!=d&&void 0!=d&&d instanceof Object&&d.redirectSuccessUrl&&""!=d.redirectSuccessUrl?f=d.redirectSuccessUrl:null!=d&&void 0!=d&&d instanceof Object&&d.redirect&&""!=d.redirect?f=d.redirect:null!=e&&void 0!=e&&e instanceof Object&&e.redirectSuccessUrl&&""!=e.redirectSuccessUrl&&(f=e.redirectSuccessUrl),consoleLog("Success! Redirecting page to "+f);var g=f;"undefined"!=typeof BN_EXTERNAL_DOMAIN_PREFIXED&&(g=BN_EXTERNAL_DOMAIN_PREFIXED+g),window.location=g})}},a}(),BN.Modal.Base,!0),BN.Modal.Account=BN.Modal.Account||{},BN.Modal.Account.HelpShippingPreferences=BN.Modal.Account.HelpShippingPreferences||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Account.HelpShippingPreferences")};return a.prototype={tplName:"m-help-shipping-preferences",initView:function(){}},a}(),BN.Modal.Account.Base,!0),BN.Modal.Account=BN.Modal.Account||{},BN.Modal.Account.ConfirmEmailChange=BN.Modal.Account.ConfirmEmailChange||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Account.ConfirmEmailChange")};return a.prototype={tplName:"m-confirm-email-change",initView:function(){var a=$(this.modal);this.initGenericView(),this.initForm(!1),a.find("#emailChangeSubmit").on("click",function(){a.find(".btn-cancel").click(),$("#changeEmailForm .btn-submit").click()})}},a}(),BN.Modal.Account.Base,!0),BN.Modal.Account=BN.Modal.Account||{},BN.Modal.Account.EditAddress=BN.Modal.Account.EditAddress||Extend(function(){var a=function(a,b){consoleLog("Instantiating BN.Modal.Account.EditAddress"),consoleLog("Received address data:",b),consoleLog("Getting address ID..."),b&&b.data&&b.data.id&&(this.address=b),consoleLog("Retrieved Address ID: "+this.address.data.id),this.Display()};return a.prototype={address:null,tplName:"editaddress",defaultVal:null,defaultOptions:{autoDisplay:!1,manualDisplayDom:!0,modalIsScrollable:!0},initView:function(){consoleLog("Initializing view...");var b=this,c=this.address,d=$(this.modal),e=d.find("form");this.defaultVal=c.getDataValue("default"),this.excludeUPSVal=c.getDataValue("excludeUPS"),b.on("display",function(){this.defaultVal&&d.find("#setDefaultShipping").click(),this.excludeUPSVal&&d.find("#poBoxADOFPO").click()}),d.find("#addAddressCancel").on("click",function(a){a.preventDefault(),b.Close()}),consoleLog("Attaching success listener"),e.on("amplifiFormSuccess",function(d,e){consoleLog("Updating address using values stored in editor",e),c.setValues(e.data),b.defaultVal!=c.getDataValue("default")?window.location=window.location:(consoleLog(c),new a.prototype.initEditAddressSuccessModal(b.data.target),b.Close())}).on("amplifiCountryChange",function(){}).on("result.QAS",function(){}).find('[type="submit"]').on("click",function(){BN.Validate.HasErrors(e)?b.displaySpinner():b.hideSpinner()}),consoleLog("Attempting to add values to editor"),c.fillEditor(this.modal),consoleLog("Initializing Generic View"),this.initGenericView(),consoleLog("Initializing Modal Form"),this.initForm(!1),this.__displayDom();var f=$("#state");f.val(b.address.getDataValue("addressRegion")),modalDisableUsTerritories(d)},initEditAddressSuccessModal:function(a){new BN.Modal.Success(null,{target:a,title:"We&#8217;ve Updated Your Account",messages:[{type:"success",message:"We have successfully updated your Address!"}]},{css:{position:"fixed"}})}},a}(),BN.Modal.Account.Base,!0),BN.Modal.Account=BN.Modal.Account||{},BN.Modal.Account.EditKid=BN.Modal.Account.EditKid||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Account.EditKid")},b=($("#bannerTrigger"),"sdsfssfd/Gender/04/2013"),c=0;return a.prototype={tplDir:SITE_ROOT+"/modals/membership/",tplName:"m-edit-kid-in-member",defaultOptions:{tplParams:{props:b,index:c}},initView:function(){var a=$(this.modal),b=this;this.initGenericView(),this.initForm(),a.find(".btn-submit").on("click",function(c){if(c.preventDefault(),$form=$(this).closest("form"),BN.Validate.HasErrors($form)){var d=$(this).data("index"),e=(a.find("#childsBirthSet").find(".kidval:visible"),$(".kids-container")),f=e.find("ul").first();"remove"==$(this).data("click")?b.deleteRow(d,f):b.updateRowSimple(d,f),b.Close()}})},updateRowSimple:function(a,b){var c=b.find("#item_"+a),d=$("#editKidForm #fName").val()+"/"+$("#editKidForm #gender option:selected").text()+"/"+$("#editKidForm #kidMonth").val()+"/"+$("#editKidForm #kidYear").val(),e=$("#editKidForm #fName").val()+"/"+$("#editKidForm #gender option:selected").text()+"/"+$("#editKidForm #kidMonth option:selected").text()+"-"+$("#editKidForm #kidYear").val();c.find("span").html(e),c.attr("data-val",d);var f=c.find("a").attr("href").split("?")[0];c.find("a").attr("href",f+"?props="+d+"&index="+a)},updateRow:function(a,b,c){var d=c.find("#item_"+a),e="",f="";b.each(function(a){var b=$(this),c=b.val();""==c&&(c=b.text()),e+=c,f+=c,2==a?(e+="-",f+="/"):2>a&&(e+="/",f+="/")}),d.find("span").html(e),d.find("span").data("val",f);var g=d.find("a").attr("href").split("?")[0];d.find("a").attr("href",g+"?props="+f+"&index="+a)},deleteRow:function(a,b){var c=b.find("#item_"+a);c.remove(),updateIndexes()}},a}(),BN.Modal.Account.Base,!0),BN.Modal.Account=BN.Modal.Account||{},BN.Modal.Account.EditPayment=BN.Modal.Account.EditPayment||Extend(function(){var a=function(a,b){consoleLog("Instantiating BN.Modal.Account.EditPayment"),consoleLog("Received payment data:",b),consoleLog("Getting payment ID..."),b&&b.data&&b.data.id&&(this.payment=b),consoleLog("Retrieved Payment ID: "+this.payment.data.id),this.Display()},b="editpayment";return $("body").hasClass("checkout-member")&&(b="editpaymentorder"),$("body").hasClass("anonymous-order-review")&&(b="editpaymentanonorder"),a.prototype={payment:null,tplName:b,defaultVal:null,defaultOptions:{autoDisplay:!1,manualDisplayDom:!0,modalIsScrollable:!0},initView:function(){consoleLog("Initializing view...");var b=this,c=this.payment,d=$(this.modal),e=d.find("form");this.defaultVal=c.getDataValue("default"),d.find("#addPaymentCancel").on("click",function(a){a.preventDefault(),b.Close()}),consoleLog("Attaching success listener"),e.on("amplifiFormSuccess",function(d,e){if(consoleLog("Updating payment using values stored in editor",e),c.setValues(e.data),b.defaultVal!=c.getDataValue("default")||$("body").hasClass("anonymous-order-review")){var f=location.href;f=f.split("#"),location.href=f[0]}else new a.prototype.initEditPaymentSuccessModal,b.Close()}).on("amplifiCountryChange",function(){}).on("result.QAS",function(){}).find('[type="submit"]').on("click",function(){return BN.Validate.HasErrors(e)?void b.displaySpinner():(b.hideSpinner(),!1)}),c.config.properties.initialErrors&&(BN.Validate.DisplayErrors(e,c.config.properties.initialErrors),delete c.config.properties.initialErrors),consoleLog("Attempting to add values to editor"),c.fillEditor(this.modal),consoleLog("Initializing Generic View"),this.initGenericView(),consoleLog("Initializing Modal Form"),this.initForm(!1),d.find('[data-editprop="creditCardIcon"]').attr("data-icon",c.getDataValue("creditCardIcon")),d.find("#useShippingAddress").on("click",function(){$(this).prop("checked")?$("#addressInputs").addClass("no-display"):$("#addressInputs").removeClass("no-display")}),e.find("#addAddress h3 a, #existingAddress h3 a").on("click",function(a){a.preventDefault();var e=$(this).parents("section").first().attr("id"),f=d.find("#addAddress"),g=d.find("#existingAddress"),h=d.find("#firstName");"addAddress"==e?(f.attr({hidden:"true","aria-hidden":"true"}),g.removeAttr("hidden"),b.clearForm(f),$("#state").removeAttr("required"),g.find("h3 a").focus()):(f.removeAttr("hidden"),g.attr({hidden:"true","aria-hidden":"true"}),h.click(),c.fillEditor(f[0]),$("#state").attr("required","required")),togglePaymentBillingAddressForm(),b.RefreshPosition()}),this.__displayDom();var f=$("#state");address=b.payment.getDataValue("$PostalAddress"),state=address.getDataValue("addressRegion"),f.val(state),modalDisableUsTerritories(d)},initEditPaymentSuccessModal:function(){var a=[];a.push({type:"success",message:"We have successfully updated your Payment method!"}),new BN.Modal.Success(null,{title:"We've Updated Your Payment Methods",messages:a},{css:{position:"fixed"}})}},a}(),BN.Modal.Account.Base,!0),BN.Modal.Account=BN.Modal.Account||{},BN.Modal.Account.ConfirmDelete=BN.Modal.Account.ConfirmDelete||Extend(function(){var a=function(a,b){consoleLog("Instantiating BN.Modal.Account.ConfirmDelete"),consoleLog("Using "+(a||this.tplName)+" template"),this.data=b};return a.prototype={tplName:null,tplDir:SITE_ROOT+"/modals/account/",initView:function(){var a=this,b=this.data,c=$(this.modal);b.fillEditor(c),c.find('[data-editprop="creditCardIcon"]').attr("data-icon",b.getDataValue("creditCardIcon"));var d=parseInt(c.find('[data-editprop="expirationMonth"]').text(),10);10>d&&(d="0"+d),c.find('[data-editprop="expirationMonth"]').text(d),c.find("form").on("submit",function(){a.displaySpinner()})}},a}(),BN.Modal.Account.Base,!0),BN.Modal.Account=BN.Modal.Account||{},BN.Modal.Account.RentalShippingLabel=BN.Modal.Account.RentalShippingLabel||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Account.RentalShippingLabel")};return a.prototype={tplName:"shipping-label",initView:function(){this.initGenericView()}},a}(),BN.Modal.Account.Base,!0),BN.Modal.Account=BN.Modal.Account||{},BN.Modal.Account.Login=BN.Modal.Account.Login||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Account.Login")};return a.prototype={tplName:"login",defaultOptions:{tplParams:{parentUrl:encodeURIComponent(location.href),tplName:"login"},useCache:!1},initView:function(){var a=this.data,b=$(a.target),c=b.attr("href")||"";BN.ModalTarget=a.target,BN.loginRedirectTo=b.length&&""!=c&&"#"!=c&&c.indexOf("/modal")<0?c:"",this.data.redirectSuccessUrl=BN.loginRedirectTo,this.initGenericView(),this.initFrameForm(),a.onclose&&this.closeEvents.all.push(a.onclose)}},a}(),BN.Modal.Account.Base,!0),BN.Modal.Account.LoginMembership=BN.Modal.Account.LoginMembership||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Account.LoginMembership")};return a.prototype={tplName:"login-membership",defaultOptions:{tplParams:{parentUrl:encodeURIComponent(location.href),tplName:"login-membership"},useCache:!1},initView:function(){var a=this.data,b=$(a.target),c=b.attr("href")||"";b.length&&""!=c&&"#"!=c&&c.indexOf("/modal")<0?(BN.loginRedirectTo=a.redirectSuccessUrl=c,a.redirect=!0):(BN.loginRedirectTo=a.redirectSuccessUrl="",a.redirect=!1),this.initGenericView(),this.initFrameForm()}},a}(),BN.Modal.Account.Base,!0),BN.Modal.Account.LoginCheckout=BN.Modal.Account.LoginCheckout||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Account.LoginCheckout")};return a.prototype={tplName:"login",defaultOptions:{tplParams:{parentUrl:encodeURIComponent(location.href),tplName:"login",isCheckout:"true"},useCache:!1},initView:function(){{var a=this.data,b=$(a.target);b.attr("href")||""}this.initGenericView(),this.initFrameForm()}},a}(),BN.Modal.Account.Base,!0),BN.Modal.Account.LoginCheckoutMembership=BN.Modal.Account.LoginCheckoutMembership||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Account.LoginCheckoutMembership")};return a.prototype={tplName:"login-membership",defaultOptions:{tplParams:{parentUrl:encodeURIComponent(location.href),tplName:"login-membership",isCheckout:"true"},useCache:!1},initView:function(){var a=this.data,b=$(a.target),c=b.attr("href")||$(a).attr("data-href")||"";""!=c&&"#"!=c&&c.indexOf("/modal")<0?(BN.loginRedirectTo=a.redirectSuccessUrl=c,a.redirect=!0):(BN.loginRedirectTo=a.redirectSuccessUrl="",a.redirect=!1),this.initGenericView(),this.initFrameForm(),$(this.modal).find(".error-msg").show()}},a}(),BN.Modal.Account.Base,!0),BN.Modal.Account.ForgotPassword=BN.Modal.Account.ForgotPassword||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Account.ForgotPassword")};return a.prototype={tplName:"reset-password",initView:function(){}},a}(),BN.Modal.Account.Base,!0),BN.Modal.Account.ChangePassword=BN.Modal.Account.ChangePassword||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Account.ChangePassword")};return a.prototype={tplName:"change-password",initView:function(){}},a}(),BN.Modal.Account.Base,!0),BN.Modal.Account.ForgotPasswordEmail=BN.Modal.Account.ForgotPasswordEmail||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Account.ForgotPasswordEmail")};return a.prototype={tplName:"reset-password-email",initView:function(){}},a}(),BN.Modal.Account.Base,!0),BN.Modal.Account=BN.Modal.Account||{},BN.Modal.Account.MemberShippingDetails=BN.Modal.Account.MemberShippingDetails||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Account.MemberShippingDetails")};return a.prototype={tplName:"m-member-shipping-details",initView:function(){var a=this.data,b=$(a.target),c=b.attr("href")||"";!a.redirectSuccessUrl&&b.length>-1&&""!=c&&"#"!=c&&("/"==c.substr(0,1)&&(c=SITE_DOMAIN_URL+c),consoleLog(c),a.redirectSuccessUrl=c),this.initGenericView(),this.initForm()}},a}(),BN.Modal.Account.Base,!0),BN.Modal.Account=BN.Modal.Account||{},BN.Modal.Account.Register=BN.Modal.Account.Register||Extend(function(){var a=function(a,b,c,d){consoleLog("Instantiating BN.Modal.Account.Register"),this.data=this.data||b||{},d&&d.pureModal&&"object"==typeof d.data&&(consoleLog("SET DATA TARGET: "+d.data.target),this.data.target=d.data.target)};return a.prototype={tplName:"register",defaultOptions:{tplParams:{tplName:"register"}},initView:function(){this.on("display",function(){if("undefined"!=typeof s_setP){var a=new Date,b=getAnalyticsEventCount();s_setP("digitalData.event["+b+"].eventInfo.eventName","Create Account Start"),s_setP("digitalData.event["+b+"].eventInfo.eventAction","createAccountStart"),s_setP("digitalData.event["+b+"].eventInfo.timeStamp",""+a),s_setP("digitalData.event["+b+"].category.primaryCategory","User"),_satellite.track("onCreateAccountStart")}}),this.initFrameForm()}},a}(),BN.Modal.Account.Login,!0),BN.Modal.Account.RegisterCheckout=BN.Modal.Account.RegisterCheckout||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Account.RegisterCheckout")};return a.prototype={tplName:"register-checkout"},a}(),BN.Modal.Account.Login,!0),BN.Modal.Account=BN.Modal.Account||{},BN.Modal.Account.FreeShippingDetails=BN.Modal.Account.FreeShippingDetails||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Account.FreeShippingDetails")};return a.prototype={tplName:"m-free-shipping-details",initFocusSelector:"h1#dialog-title",initView:function(){var a=this.data,b=$(a.target),c=($(this.modal),b.attr("href")||"");!a.redirectSuccessUrl&&b.length>-1&&""!=c&&"#"!=c&&("/"==c.substr(0,1)&&(c=SITE_DOMAIN_URL+c),consoleLog(c),a.redirectSuccessUrl=c),this.initGenericView(),this.initForm()}},a}(),BN.Modal.Account.Base,!0);;/*! BARNES-BUILDER 2016-11-18 */
BN.Modal.Account.Wishlist=BN.Modal.Account.Wishlist||{},BN.Modal.Account.Wishlist.Base=BN.Modal.Account.Wishlist.Base||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Account.Wishlist.Base")};return a.prototype={tplName:"createWishlist",initView:function(){this.initGenericView(),this.initForm()}},a}(),BN.Modal.Account.Base,!0),BN.Modal.Account.Wishlist=BN.Modal.Account.Wishlist||{},BN.Modal.Account.Wishlist.Add=BN.Modal.Account.Wishlist.Add||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Account.Wishlist.Add")};return a.prototype={tplName:"add-to-wishlist",defaultOptions:{useCache:!1},initView:function(){this.initGenericView(),this.initForm(!1),consoleLog("Initializing View: BN.Modal.Account.Wishlist.Add");var a=this,b=$(this.modal),c=b.find("form"),d=$(this.data.target).attr("data-create-list")||"";this.on("display",function(){d&&$(".privacy-settings").show(),initializeTextAreaCounter($("textarea#wishlistDescription"),$(".limit-notifier")),$("#selectWishlist").change()}),c.on("amplifiFormSuccess",function(){if("undefined"!=typeof s_setP){var c=getAnalyticsEventCount();""==d&&(s_setP("digitalData.event["+c+"].eventInfo.eventName","Add Item to Wish List"),s_setP("digitalData.event["+c+"].eventInfo.eventAction","addItemToWishList"),s_setP("digitalData.event["+c+"].eventInfo.timeStamp",""+new Date),_satellite.track("onAddItemToWishList")),(d||""==b.find("input#giftListId").val())&&(s_setP("digitalData.event["+c+"].eventInfo.eventName","Create Wish List"),s_setP("digitalData.event["+c+"].eventInfo.eventAction","createWishList"),s_setP("digitalData.event["+c+"].eventInfo.timeStamp",""+new Date),_satellite.track("onCreateWishList"))}a.Close(),new BN.Modal.Success(null,{title:d?"Wishlist Created":"Item added to wishlist",messages:[{type:"success",message:d?"You have successfully created a new Wishlist.":"We've successfully added your item to your wishlist"}],target:a.data.target,onclose:function(){location.reload()}})})}},a}(),BN.Modal.Account.Wishlist.Base,!0),BN.Modal.Account.Wishlist=BN.Modal.Account.Wishlist||{},BN.Modal.Account.Wishlist.Delete=BN.Modal.Account.Wishlist.Delete||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Account.Wishlist.Delete")};return a.prototype={tplName:"delete-wishlist",initView:function(){this.initGenericView(),this.initForm()}},a}(),BN.Modal.Account.Wishlist.Base,!0),BN.Modal.Account.Wishlist=BN.Modal.Account.Wishlist||{},BN.Modal.Account.Wishlist.Edit=BN.Modal.Account.Wishlist.Edit||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Account.Wishlist.Edit")};return a.prototype={tplName:"edit-wishlist",initView:function(){this.initGenericView(),this.initForm(),this.on("display",function(){initializeTextAreaCounter($("textarea#wishlistDescription"),$(".limit-notifier"))})}},a}(),BN.Modal.Account.Wishlist.Base,!0),BN.Modal.Account.Wishlist=BN.Modal.Account.Wishlist||{},BN.Modal.Account.Wishlist.Email=BN.Modal.Account.Wishlist.Email||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Account.Wishlist.Email")};return a.prototype={tplName:"emailWishlist",initView:function(){this.initGenericView(),this.initForm()}},a}(),BN.Modal.Account.Wishlist.Base,!0),BN.Modal.Account.Wishlist=BN.Modal.Account.Wishlist||{},BN.Modal.Account.Wishlist.EmailSuccess=BN.Modal.Account.Wishlist.EmailSuccess||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Account.Wishlist.EmailSuccess")};return a.prototype={defaultOptions:{useCache:!1},tplName:"emailWishlistSuccess",initView:function(){this.initGenericView(),this.on("display",function(){if("undefined"!=typeof recipientsEmails&&""!=$.trim(recipientsEmails)){var a=recipientsEmails.split(",");$.each(a,function(a,b){var c=$.trim(b);""!=c&&$(".share-email-list").append('<li><span data-icon="checkmark">Success!</span>'+c+"</li>")})}})}},a}(),BN.Modal.Account.Wishlist.Base,!0),BN.Modal.Account.Wishlist=BN.Modal.Account.Wishlist||{},BN.Modal.Account.Wishlist.Share=BN.Modal.Account.Wishlist.Share||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Account.Wishlist.Share")};return a.prototype={tplName:"emailWishlist",initView:function(){this.initGenericView(),this.initForm();var a=$(this.modal),b=a.find("form");b.on("amplifiFormSuccess",function(){recipientsEmails=$("#recipientsEmail").val()}),this.on("display",function(){initializeTextAreaCounter($("textarea#descriptionArea"),$(".limit-notifier")),$(".copy-wl-url").click(function(a){a.preventDefault(),$(".wl-share-link").selectText()}),$("#recipientsEmail, #descriptionArea").attr("required","required")})}},a}(),BN.Modal.Account.Wishlist.Base,!0);;/*! BARNES-BUILDER 2016-11-18 */
BN.Modal.Browse=BN.Modal.Browse||{},BN.Modal.Browse.Base=BN.Modal.Browse.Base||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Browse.Base")};return a.prototype={defaultOptions:{tplDir:SITE_ROOT+"/modals/search/"}},a}(),BN.Modal.Base,!0),BN.Modal.Browse=BN.Modal.Browse||{},BN.Modal.Browse.BulkOrderSearch=BN.Modal.Browse.BulkOrderSearch||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Browse.BulkOrderSearch")};return a.prototype={tplName:"bulk-order-search",defaultOptions:{useCache:!1},currentIndex:0,firstAdd:!1,initView:function(){{var a=this;$(this.modal),$(this.data.target)}this.on("display",function(){var b=$("#resultsMainContainer"),c=$("#frmBulkSearch");b.hide(),$("#bulkSearchFilterSelect").selectBox(),c.find(".selectBox-dropdown .selectBox-label").attr("style","width: 114px !important"),BN.uXHR.Form.apply(c),c.on("amplifiFormSuccess",function(b,c){a.displayResults(c.redirectUrl)}).on("amplifiFormBeforeSubmit",function(){a.unready()}),""!=$("#txtBulkSrch").val()?c.find("#bulkSearchSubmit").click():$(".loading-indicator-holder").hide()})},unready:function(){this.$spinner&&this.$spinner.length>0&&this.$spinner.remove(),$(".loading-indicator-holder").show(),$("#resultsMainContainer").hide(),this.displaySpinner()},ready:function(){$("#resultsMainContainer").show(),$(".loading-indicator-holder").hide(),this.$spinner.remove()},addItem:function(){var a=$(this.data.target);that=this,0==that.currentIndex&&(that.currentIndex=a.attr("id").split("_")[1]),$("#resultsMainContainer").find(".add-isbn-info a").on("click",function(){var b=$(this);if("Added"!=b.html()){{a.parents("li:first")}if(that.firstDone){var c=$(".bulk-order-container section.quote-items");c.find("a.add-item").click(),that.currentIndex=parseInt(that.currentIndex)+1;var d=c.find("#search_"+that.currentIndex);that.fillValues(d,b)}else that.firstDone=!0,that.fillValues(a,b);b.html("Added").removeClass("btn").addClass("not-active")}})},displayResults:function(a){var b=this;$("#resultsMainContainer").load(a,function(){$(this).html($("#resultsListContainer").html()),b.initOpeners(),b.ready(),b.addItem(),b.paginate(),b.close()})},fillValues:function(a,b){var c=a.parents("li:first"),d=c.find("[id^='item_title']"),e=c.find("[id^='item_isbn']"),f=b.data("isbn-id"),g=b.data("title");a.hide(),a.siblings().show(),d.val(g),e.val(f)},paginate:function(){var a=this;$("#resultsMainContainer").find("li.pagination ul li a").on("click",function(b){b.preventDefault(),a.unready();var c=$(this).attr("href");a.displayResults(c)})},close:function(){$("#sectionBulkSrch div.confirm .btn").on("click",function(){that.Close()})}},a}(),BN.Modal.Browse.Base,!0),BN.Modal.Browse=BN.Modal.Browse||{},BN.Modal.Browse.Formats=BN.Modal.Browse.Formats||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Browse.Formats")};return a.prototype={tplName:"allFormats",defaultOptions:{useCache:!1},initView:function(){var a=this,b=$dom=$(this.modal),c=$(this.data.target),d=(c.attr("id"),c.attr("data-formatsUrl")),e=$("body").hasClass("pdpPage"),f=(c.data("formats-edition")?c.data("formats-edition"):!1,c.attr("data-product-id")||c.attr("id")),g=c.data("work-id"),h=c.attr("data-sku-id"),i=c.attr("data-digital-ean"),j=(c.attr("data-total-formats"),c.attr("data-ismarketplace"));"https:"===SITE_PROTOCOL&&-1!=d.indexOf("http:")&&(d=d.replace("http","https")),this.displaySpinner(),("undefined"==typeof this.productName||""==this.productName)&&this.getProductNameByURL(c.closest("#prodSummary").length>0?THIS_PATH:c.attr("data-pd-quickview-url")),b.find("#open-prod-details").attr("data-ismarketplace",j),this.on("display",function(){b.find("#pdpModalContent").load(d,function(){b.find("#otherAvailableFormatsContainer .actions form span").hide(),a.$spinner.remove(),b.find(".tabgroup section:nth-of-type(n + 2)").css("display","none"),b.find(".alt-format").hide(),("false"==e||0==e)&&(b.find("#qvTitleBar li:first").siblings().find("a#open-prod-details").show(),("true"==j||1==j)&&b.find("#qvTitleBar li:first").siblings().find("a.open-marketplace").show()),b.find(".tabgroup h3:first-child a").addClass("activeTab").attr({"aria-selected":"true","aria-expanded":"true"}),b.find(".tabgroup h3:first-child").next("section").show(),b.find(".tabgroup h3 a").on("click",function(a){a.preventDefault(),b.find(".tabgroup section").css("display","none"),$(this).parent().next("section").css("display","block"),b.find(".tabgroup h3 a").each(function(){$(this).removeClass("activeTab").attr({"aria-selected":"false","aria-expanded":"false"})}),$(this).addClass("activeTab").attr({"aria-selected":"true","aria-expanded":"true"})}),$(".format-list-container").on("scroll",function(c){var d=$(c.currentTarget),e=$(this).find(".section-items"),f=e.attr("data-total-items"),j=e.attr("data-format-type");if(d[0].scrollHeight-d.scrollTop()==d.outerHeight()){var k=e.children().length,l=parseInt(e.children().last().attr("data-start")),m=parseInt(e.children().last().attr("data-end"));f>k&&(l+=10,m+=10,$.ajax({url:"/cartridges/ProductDetailContent/ProductDetailTypes/includes/all-format-list-content.jsp",type:"get",cache:!1,data:{skuId:h,workId:g,digitalEan:i,format:j,start:l,end:m},dataType:"html",beforeSend:function(){a.displaySpinner()}}).done(function(c){e.append(c),attachCartAction(!0),b.find("#otherAvailableFormatsContainer .actions form span").hide(),setTimeout(function(){a.$spinner.remove()},500)}))}}),attachCartAction(!0)});var c=this.flow().get("quickview"),k=b.find("#open-prod-details"),l=a.flow().get("marketplace"),m=$(a.modal).find(".open-marketplace");l&&l.pureModal?(m.removeAttr("data-sku-id"),m.removeAttr("data-product-id"),m.removeAttr("data-modal-class"),m.removeAttr("data-formats-edition"),m.attr("data-crumb","marketplace"),m.each(function(){a.__initCrumbEvent(this)})):(m.attr("data-sku-id",h),m.attr("data-product-id",f),m.attr("data-work-id",g),m.attr("data-modal-class","BN.Modal.Browse.Marketplace"),m.attr("data-formats-edition","true"),m.attr("data-formatsUrl",d),m.attr("data-ismarketplace",j)),c&&c.pureModal?(this.__initCrumbEvent(k.attr("data-crumb","quickview").get(0)),$dom.find("#qvTitleBar").on("click","a#open-prod-details",function(a){a.preventDefault(),showProductDetails($(c.modal)),$("#pdpModalContent").show()})):$(this.data.target).attr("data-pd-modal")&&$dom.find("#qvTitleBar").find("a#open-prod-details").attr({"data-modal-class":"BN.Modal.Browse.Quickview",href:$(this.data.target).attr("data-pd-modal"),"data-quickview-url":$(this.data.target).attr("data-pd-quickview-url"),"data-work-id":$(this.data.target).attr("data-work-id"),"data-sku-id":$(this.data.target).attr("data-sku-id"),"data-is-marketplace":$(this.data.target).attr("data-is-marketplace"),"data-modal":"%href%"}),a.initOpeners(),b.on("click",".close-modal",function(a){a.preventDefault();var b=Modal.prototype.openModals;for(var c in b){var d=b[c];d&&d.Close&&d.Close()}}),b.on("click",".potterMoreModal",function(b){b.preventDefault(),new BN.Modal.Browse.PDP.PottermoreBuy(null,{target:{id:$(this).attr("id"),href:$(this).attr("href")}},null,a)})})}},a}(),BN.Modal.Browse.Base,!0),BN.Modal.Browse=BN.Modal.Browse||{},BN.Modal.Browse.ISBN=BN.Modal.Browse.ISBN||Extend(function(){var a=function(a,b){this.data=b,consoleLog("Instantiating BN.Modal.Browse.ISBN")};return a.prototype={defaultOptions:{tplDir:SITE_ROOT+"/modals/"},tplName:"isbn-index"},a}(),BN.Modal.Base,!0),BN.Modal.Browse.GiftMessage=BN.Modal.Browse.GiftMessage||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Browse.GiftMessage")};return a.prototype={defaultOptions:{tplDir:SITE_ROOT+"/modals/"},tplName:"gift-message",initView:function(){var a=this,b=$(this.modal),c=a.data.target,d=$(c).data("messageid"),e=$("#"+d).text();b.find("#giftMessageModal").text(e)}},a}(),BN.Modal.Base,!0),BN.Modal.Browse=BN.Modal.Browse||{},BN.Modal.Browse.Isbndef=BN.Modal.Browse.Isbndef||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Account.Isbndef")};return a.prototype={defaultOptions:{tplDir:SITE_ROOT+"/modals/"},tplName:"m-isbn-definition-details"},a}(),BN.Modal.Browse.Base,!0),BN.Modal.Browse=BN.Modal.Browse||{},BN.Modal.Browse.Condition=BN.Modal.Browse.Condition||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Browse.Condition")};return a.prototype={tplName:"m-condition",defaultOptions:{useCache:!1,tplDir:SITE_ROOT+"/modals/marketplace/"},initView:function(){var a=this.data,b=$(a.target),c=b.attr("href")||"";!a.redirectSuccessUrl&&b.length>-1&&""!=c&&"#"!=c&&("/"==c.substr(0,1)&&(c=SITE_DOMAIN_URL+c),consoleLog(c),a.redirectSuccessUrl=c),this.initGenericView(),this.initForm()}},a}(),BN.Modal.Browse.Base,!0),BN.Modal.Browse=BN.Modal.Browse||{},BN.Modal.Browse.Marketplace=BN.Modal.Browse.Marketplace||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Browse.Marketplace")};return a.prototype={tplName:"marketplace",suppressAutoTabindex:!0,listOptions:{condition:"All",sortBy:"pricel"},sorters:{rating:{desc:"Seller Rating"},bnPrice:{asc:"Price - Low to High",desc:"Price - High to Low"},condition:{condition:"Condition"}},lists:{},reviewsURL:null,firstReady:!0,defaultOptions:{useCache:!1},trimText:function(a,b){var c=a,d=b;if(c.length>d){var e=c.lastIndexOf(" ");if(-1===e)c=c.slice(0,d-3),c+="...";else if(e>-1){c=c.slice(0,d-3);var f=c.lastIndexOf(" ");c=c.slice(0,f),c+="..."}}return c},initToolTip:function(){var a=$("span[data-icon=plus-expand]");$(".expand-tooltip-container").hide(),a.on("click",function(){var a=$(this);a.parents("li").siblings().find(".expand-tooltip-container").hide().end().find("span[data-icon=plus-expand]").removeClass("expandicon-change"),a.prev(".expand-tooltip-container").toggle(),a.toggleClass("expandicon-change")})},closeToolTips:function(){$(".marketplace-tab h3 label").on("click",function(){$(this).parents(".tabgroup").find(".expand-tooltip-container").hide().end().find("span[data-icon=plus-expand]").removeClass("expandicon-change")})},readMore:function(){$(".seller-info dl dd .down-arrowhead").on("click",function(){var a=$(this),b=a.siblings(".full-comments").text();a.parent().find("[data-prop=comments]").text(b),a.addClass("no-display")})},initConditionsModal:function(){var a=$(".tab-select");a.on("click",function(){new BN.Modal.Browse.Condition(null,{target:this},null,null)})},initView:function(){var a=$(this.modal),b=this;return this.unready(),this.initGenericView(),("undefined"==typeof this.productName||""==this.productName)&&$(this.data.target).closest("#prodInfoContainer").length>0&&this.getProductNameByURL(THIS_PATH),this.on("display",function(){var b={streamID:this.data["work-id"],categoryID:"Products",containerID:"gigyaRating",ratingTemplate:a.find("data#gigyaRating").html(),onLoad:function(){$("#gigyaRating .gig-rating-readReviewsLink").attr("href",$("#prodReviewInfo .gig-rating-readReviewsLink").attr("href")+"#reviews-header")},onReadReviewsClicked:function(){window.location=$("#prodReviewInfo .gig-rating-readReviewsLink").attr("href")+"#reviews-header"}};"undefined"!=typeof gigya&&gigya.comments.showRatingUI(b)}),BN.uXHR.getService("marketplace-items",{productId:this.data["product-id"]},function(){b.initContainerDom.apply(b,arguments)}),!0},unready:function(){$(this.modal).find(".mrkt-prod-name,.marketplace-tab").css({visibility:"hidden"}),this.$spinner&&this.$spinner.length>0&&this.$spinner.remove(),this.displaySpinner()},ready:function(){$(this.modal).find(".mrkt-prod-name,.marketplace-tab").css({visibility:"visible"}),this.$spinner.remove(),$(this.dom).off("click","a",this.__anchorClick),$(this.dom).on("click","a",this.__anchorClick)},__anchorClick:function(a){"#"==$(this).attr("href")&&a.preventDefault()},initContainerDom:function(a){this.servResp=a.service;var b=this,c=$(this.modal),d=$(this.data.target).data("formats-edition")?$(this.data.target).data("formats-edition"):!1,e=this.servResp.product,f="",g="",h="",i="",j=$("body").hasClass("pdpPage")?!0:!1,k=["All","New","Used"],l=this.servResp.items,m=this.itemsByCond=this.separateByCondition(l),n=$(this.data.target).data("work-id")||"",o=($(this.data.target).attr("data-formatsurl"),$(this.data.target).attr("data-ismarketplace"));if(e&&e.hasOwnProperty("skus")){var p=e.skus;p.length>1?(f=p[0],h=f.displayName,i=f.contributor):(f=p,h=f[0].displayName,i=f[0].contributor)}f&&f.hasOwnProperty("edition")&&(g=""!=f.edition?"("+f.edition+")":""),b.reviewsURL=f.reviewsUrl,c.find('[data-prop="productTitle"]').html(h+" "+g),c.find("[data-template]").remove(),c.find('[data-prop="contributor"]').text(i);var q=this.flow().get("quickview"),r=c.find("#open-prod-details");if(j&&r.parent().remove(),d){$('<li class="qvLink"><a href="#" class="formatModal">All Formats & Editions</a></li>').insertAfter(c.find("ul.quick-view-nav li")[1]);var s=c.find(".formatModal");s.attr("data-ismarketplace",o),c.find("#qvTitleBar").on("click",".formatModal",function(a){a.preventDefault(),new BN.Modal.Browse.Formats(null,b.data,null,b)})}if(q&&q.pureModal)this.__initCrumbEvent(r.attr("data-crumb","quickview").get(0)),c.find("#qvTitleBar").on("click","a#open-prod-details",function(a){a.preventDefault(),showProductDetails($(q.modal)),$("#pdpModalContent").show()}),c.on("click",".close-modal",function(a){a.preventDefault(),b.Close(),q.Close()});else if(window.location.toString().indexOf(f.pdpUrl)>-1)r.on("click",function(){b.Close()});else{e&&e.id&&r.attr("data-product-id",e.id),f&&f.pdpUrl&&r.attr("data-quickview-url",f.pdpUrl),r.attr("data-work-id",n),r.attr("data-modal-class","BN.Modal.Browse.Quickview"),this.initOpeners(r.parent().get(0));var t=c.find("#qvTitleBar #showAllFormats");e&&e.id&&t.attr("data-product-id",e.id),f&&f.pdpUrl&&t.attr("data-quickview-url",f.pdpUrl),t.attr("data-pdp-view","seeAllFormats"),t.attr("data-modal-class","BN.Modal.Browse.Quickview"),b.initOpeners(t.parent().get(0))}for(this.unready(),x=0;x<k.length;x++){var u=k[x];m.hasOwnProperty(u)&&this.initTab(u)}this.initToolTip(),this.initSorter(),this.initConditionsModal(),this.closeToolTips(),this.readMore(),c.find("#AllSection").click(),this.ready(),this.removeTabIndex(),this.initLoopingModalFocus(),this.initFocusImmediately()},initLoopingModalFocus:function(){var a=this,b=$(this.modal),c=b.find(".marketplace-tab"),d=b.find(this.tabbableSelector),e=function(b){var c;b.find("[data-last-tabbable]").removeAttr("data-last-tabbable"),c=b.find('.tabgroup>.tab[type="radio"]:checked+h3+section');var e=c.find("ul").html().length>0;!e&&d.length>1?d.last().attr("data-last-tabbable","1"):c.find(a.tabbableSelector).last().attr("data-last-tabbable",1)};d.length>1&&(d.first().attr("data-first-tabbable","1"),e(c),b.on("keydown","[data-first-tabbable], [data-last-tabbable]",function(a){var c=$(this),d="1"===c.attr("data-last-tabbable"),e=1===c.data("firstTabbable");9==a.keyCode&&a.shiftKey?e&&(a.preventDefault(),b.find("[data-last-tabbable]").first().focus()):9==a.keyCode&&d&&(a.preventDefault(),b.find("[data-first-tabbable]").first().focus())}),b.find('.tabgroup>.tab[type="radio"]').on("change",function(){e(c),b.find("[data-first-tabbable]").first().focus()}))},initSorter:function(){var a=this,b=this.sorters,c=$(this.modal).find(".tabgroup .sorter");c.empty();for(var d in b){var e=b[d];for(var f in e){var g=e[f];title="object"==typeof g?g.title:g,c.append($("<option/>").attr("value",d+" "+f).text(title))}}c.on("change",function(){var b=this.value.split(/\s+/);a.sortItems(b[0],b[1])}),c.val("bnPrice asc").change(),c.selectBox()},sortItems:function(a,b){var c=this.lists,d=this.sorters[a][b];if("condition"==b){var e=["New","Like New","Very Good","Good","Acceptable","Used","Refurbished"];d=function(b){return b.sort(function(b,c){{var d=b.item[a],f=c.item[a];e.indexOf(d),e.indexOf(f)}return f>d?-1:d>f?1:0}),b.reverse(),b}}else"object"!=typeof d&&(d=function(c){return c.sort(function(b,c){var d=b.item[a],e=c.item[a],f=parseFloat(d),g=parseFloat(e);return d==f&&(d=f),e==g&&(e=g),e>d?-1:d>e?1:0}),"desc"==b&&c.reverse(),c});for(var f in c){for(var g=c[f],h=g.listDom,i=g.items,j=i.length,k=d(g.items),l=0;j>l;l++){var m=k[l];h.append(m.dom)}h.append(h.find("div.clear:empty"))}return!0},separateByCondition:function(a){var b={All:a||[]};b.Used=[];for(var c=0;c<b.All.length;c++){var d=b.All[c],e=d.condition;void 0!=b[e]?b[e].push(d):b[e]=[d],"New"!=e&&(void 0!=b[e]?b.Used.push(d):b.Used=[d])}return b},initTab:function(a){var b=(a+"Section").replace(/\s/gi,""),c=this.itemsByCond[a],d=$(this.modal),e=$(this.tpl()),f=d.find(".tabgroup"),g=$("<div/>"),h=e.find('[data-template="tabset"]').clone();return h.attr("data-template",null),g.append(h),g.children().filter("section").attr("data-condition",a),g.children().filter('.tab[type="radio"]').attr("id",b).next().find("label").attr("for",b),g.find('data[value="condition"]').text(a),g.find('data[value="conditionCount"]').text(c.length),this.initTabItems(c,g,a),f.append(g.children()),f.append(f.find("div.clear:empty")),this},initTabItems:function(a,b,c){var d=this,e=$(this.tpl()),f=b.find("section"),g=f.find(".section-items"),h=e.find(".section-items li").first().clone(),i=a.length,j=this.lists[c]={name:c,listDom:g,items:[]};g.empty();for(var k=0;i>k;k++){var l=a[k],m=a[k].ean,n=h.clone();j.items.push({dom:n,ean:m,item:l}),n.find("[data-prop]").each(function(){var a=$(this),b=a.attr("data-prop");if(void 0!=l[b])if("bnPrice"==b){var c=parseFloat(l[b]),e=c.toFixed(2);a.html("$"+e||" ")}else if("comments"==b){var f=l.comments,g=d.trimText(f,60);f.length>60?(a.html(g||" "),a.next("span").html(f),a.parent().find("a.down-arrowhead").removeClass("no-display")):a.html(f)}else if("undefined"!=typeof s_setP&&"digitalData"===b){var h=JSON.stringify(l[b]);h&&attachDataToButton(h,a)}else"digitalData"!==b&&a.html(l[b]||" ")}),n.find("data[value]").each(function(){var a=$(this).attr("value");if(void 0!=l[a])if("bnPrice"==a){var b=parseFloat(l[a]),c=b.toFixed(2);$(this).html(c||" ")}else $(this).html(l[a]||" ")});for(method in l.shipMethods){var o=l.shipMethods[method].shipDaysLow||"",p=l.shipMethods[method].shipDaysHigh||"",q=o&&p?"("+o+"-"+p+" business days)":"",r="<li>"+l.shipMethods[method].displayName+" "+q+"</li>";n.find(".ship-method-list").append(r)}n.find('[data-prop="sellerName"]').attr("href",l.sellerUrl),n.find('[data-prop="feedbackNum"]').attr("href",l.sellerReviewsUrl);var s=l.rating,t=s.split("."),u=n.find(".gig-rating-stars");u.attr("title",s),u.attr("alt",s),u.empty();for(var v=1;5>=v;v++)u.append(v>t[0]?v-1==t[0]&&t[0]>0&&t[1]>4?$("<div/>").attr("class","gig-rating-star gig-rating-star-half"):$("<div/>").attr("class","gig-rating-star gig-rating-star-empty"):$("<div/>").attr("class","gig-rating-star gig-rating-star-full"));n.find(".btn-addtocart").attr("data-ean",m).on("click",function(a){a.preventDefault(),d.displaySpinner(),BN.uXHR.getService("add-marketplace-to-cart",{mean:$(this).attr("data-ean"),productId:d.data["product-id"],skuId:d.data["sku-id"]},function(b){if(0==b.service.success){{var c=b.service.response.items,e=c.length,f=$(d.modal).find("#marketplaceError");f.find("p").length}f.empty();for(var g=0;e>g;g++)f.append($("<p/>").text(c[g]));f.show()}else{var f=$(d.modal).find("#marketplaceError");f.empty().hide(),new BN.Modal.Browse.PDP.AddToBag(null,{onClose:function(){$("body").hasClass("shopping-bag")&&(window.location.href=window.location.href)},messages:[{type:"success",message:"The item has successfully been added to your cart!"}]},{tplParams:{ean:b.service.ean}}),loadHeaderElement($("#bagContentsContainer"),webContextRoot+"/includes/shopping-bag.jsp",!0,!0),$(document).trigger("analytics-market-add",[a])}d.$spinner.remove()},function(){$(d.modal).find("#marketplaceError").append($("<p/>").text("There was a problem adding your item to cart. Please try again later.")),d.$spinner.remove()})}),g.append(n)}return this}},a}(),BN.Modal.Browse.Base,!0),BN.Modal.Browse=BN.Modal.Browse||{},BN.Modal.Browse.Quickview=BN.Modal.Browse.Quickview||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Browse.Quickview")};return a.prototype={tplName:"quickview",suppressAutoTabindex:!0,defaultOptions:{useCache:!1},trimText:function(a,b){var c=a,d=b;if(c.length>d){var e=c.lastIndexOf(" ");if(-1===e)c=c.slice(0,d-3),c+=" ...";else if(e>-1){c=c.slice(0,d-3);var f=c.lastIndexOf(" ");c=c.slice(0,f),c+=" ..."}}return c},initView:function(){var a=this,b=$(this.modal),c=$(this.data.target).attr("data-product-id")||$(this.data.target).attr("id"),d=$(this.data.target).attr("data-sku-id"),e=$(this.data.target).attr("data-quickview-url"),f=$(this.data.target).data("pdp-view"),g=$(this.data.target).data("work-id"),h=$(this.data.target).attr("data-ismarketplace");e+=e.indexOf("?")>=0?"&quickview=true":"?quickview=true",this.displaySpinner(),b.find("[data-product-id]").attr("data-product-id",c),this.getProductNameByURL(e),this.data["work-id"]=""+g,this.on("display",function(){$("#pdpModalContent").hide(),$(this.modal).find("#pdpModalContent").load(e+" #productDetail",function(){function i(a){var c=b.find(".gig-rating-readReviewsLink"),d=a&&a.instanceID?a.instanceID:"",e="ratingsDisplay"===d?"topOfPage":"customerReviewsBox";if($(document).triggerHandler("analytics-reviews-clicked",{location:e}),"Be the first to write a review"===c.html()&&$("body").hasClass("pdpPage")){var f=Modal.prototype.openModals;for(var g in f){var h=f[g];h&&h.Close&&h.Close()}$("#writeReviewBtn").click()}else window.location.href=v+"#reviews-header"}$(".quickview-holder").remove();var j=b.find(".formatModal.all-formats").parent().html(),k=b.find(".formatModal.all-formats").length,l=$("#showAllFormats").text(),m=h===$(a.data.target),n=a.flow().get("marketplace"),o=$(a.modal).find(".open-marketplace");if(k){b.find("#otherAvailableFormatsContainer .actions form span").hide();var p=$('<li class="qvLink">'+j+"</li>"),q=p.find("a"),r=q.attr("data-formatsUrl");q.text(l).removeClass("all-formats chevron"),m&&q.attr("data-ismarketplace",m),q.attr("data-sku-id",d),q.attr("data-product-id",c),q.attr("data-work-id",g),q.attr("data-crumb","allFormats"),q.attr("data-formats-edition","true"),p.insertAfter(b.find("ul.quick-view-nav li")[0])}if(n&&n.pureModal?(o.removeAttr("data-sku-id"),o.removeAttr("data-product-id"),o.removeAttr("data-modal-class"),o.removeAttr("data-formats-edition"),o.attr("data-crumb","marketplace"),o.each(function(){a.__initCrumbEvent(this)})):(o.attr("data-sku-id",d),o.attr("data-product-id",c),o.attr("data-work-id",g),o.attr("data-modal-class","BN.Modal.Browse.Marketplace"),k?o.attr("data-formats-edition","true"):o.attr("data-formats-edition","false"),o.attr("data-formatsUrl",r),o.attr("data-ismarketplace",m)),b.on("click",".close-modal",function(a){a.preventDefault();var b=Modal.prototype.openModals;for(var c in b){var d=b[c];d&&d.Close&&d.Close()}}),$(".formatModal").attr("data-ismarketplace",h),a.initOpeners(),""!=b.find("#alsoAvailableAs").html()){var s=b.find("#alsoAvailableAs").html();b.find("#quickView .alt-format").html(s)}""==$.trim(b.find("#alsoAvailableAs").text())&&b.find("#quickView .alt-format").hide(),a.$spinner.remove();var t=b.find(".format-content").text().length,u=b.find(".format-content").text();t>120?b.find(".format-content").html("<p>"+a.trimText(u,120)+'</p><a href="'+e+'">See complete product details</a>'):$("#quickView div.format-content a").html("See complete product details"),b.find("#componentDiv").appendTo(b.find("#prodInfoContainer")),b.find("#componentDiv").css({display:"block",width:"100%",clear:"both",paddingTop:"10px",marginTop:"10px",borderTop:"1px solid #ebebeb",textAlign:"center"}),b.find("#ratingsDisplay:not([data-preorder=true])").attr("id","modalRatingsDisplay");var v=e.replace("/w/","/reviews/");ratingsParams={categoryID:"Products",streamID:g,containerID:"modalRatingsDisplay",onReadReviewsClicked:i,onLoad:function(){var a=b.find(".gig-rating-readReviewsLink");"0 Reviews"===a.html()&&a.html("Be the first to write a review"),$(".gig-rating-topbar").each(function(){var a=$(this).find(".gig-rating-stars").attr("title");$(this).prepend('<span id="avgRating" class="hide-content" tabindex="0">Average Rating: '+a+"</span>")})}},"undefined"!=typeof gigya&&gigya.comments.showRatingUI(ratingsParams),$(".bn-share-link").off("click").click(function(a){a.preventDefault();var b=$(this).data("socialsharetype"),c=location.host+e;console.log("this is location.host:  "+location.host),console.log("this is the prod URL:  "+c);var d="http:"+$("#pdpMainImage").attr("src");console.log("this img the share url: "+d);var f=$("#prodSummary h1").text()+" by "+$("#prodSummary .contributors a").text().replace(/(\r\n|\n|\r)/gm,"").trim();console.log("this is the share title: "+f);var g={url:c,provider:b,title:f,thumbnailURL:d,shortURLs:"never"};gigya.socialize.postBookmark(g)}),b.find("#quickView ul.options li").each(function(){""==$(this).html().trim()&&$(this).remove()}),b.find("#ratingsSocial span:not(.count)").remove(),b.find("a.all-formats").parent("p").hide(),initInstantPurchaseSignIn(),openLoginModal("#quickView .btn-instant-purchase",{preventDefault:"conditionally",successCallback:function(){var b=$(this).attr("class");"btn-instant-purchase"!==b.trim()&&$(this).click(),a.displaySpinner()},runSuccessCallbackOnce:!0,keepParentModalOpen:!0}),b.find(".tabgroup section:not(first-child)").css("display","none"),b.find("#qvTitleBar").on("click","#showAllFormats",function(a){a.preventDefault(),showAllFormats(b)}),b.find("#qvTitleBar").on("click","a#backToDetails",function(a){var c=b.find("#prodSummary");a.preventDefault(),c.parents("#productDetail").removeClass("formats-n-editions"),c.children().not("#qvFormatsTabContent").show(),c.find("#qvFormatsLink").hide(),c.find("#qvFormatsTabContent").hide(),c.find("#availableFormats").hide(),b.find("#prodInfoContainer, #prodImage, .alt-format").show(),b.find(".quick-view-nav li.qvLink").show(),b.find(".quick-view-nav h1").html("Product Details"),$(".pure-modal").find(".quick-view-nav .qv-pdp-details").hide()}),b.find(".tabgroup h3:first-child a").addClass("activeTab"),b.find(".tabgroup h3 a").on("click",function(a){a.preventDefault(),b.find(".tabgroup section").css("display","none"),$(this).parent().next("section").css("display","block"),b.find(".tabgroup h3 a").each(function(){$(this).removeClass("activeTab")}),$(this).addClass("activeTab")}),"seeAllFormats"==f?(showAllFormats(b),$("#pdpModalContent").show()):$("#pdpModalContent").show(),$("input[name=rental-options]","#quickView").each(function(a){var b=$(this),c=$(this).attr("id"),d=c+"-"+a.toString();b.attr("id",d),b.parent().attr("for",d)});var w=$("#quickView input[name=rental-options]:checked"),x=$("#quickView input[name=rental-options]").not(w);x.parents("label").siblings().slideUp("fast"),x.parents("form").siblings().slideUp("fast"),x.siblings(".price").removeClass("no-display"),w.siblings(".price").addClass("no-display"),$(".multi-product-select").children().each(function(a,b){$(b).find("input[type=radio]").attr("checked")||$(b).addClass("grdnt-fade-white")}),$("input[name=rental-options]","#quickView").on("click",function(){var a=$(this),b=$("#quickView input[name=rental-options]"),c=b.not(a),d=a.parents("li"),e=b.parents(".subscriptions-container");d.is(":first-child")?e.children("li:first-child").removeClass("top-border"):e.children("li:first-child").addClass("top-border"),d.removeClass("grdnt-fade-white"),d.siblings().addClass("grdnt-fade-white"),c.removeAttr("checked"),c.parents("label").siblings().slideUp("fast"),c.parents("form").siblings().slideUp("fast"),c.siblings(".price").removeClass("no-display"),a.parents("label").siblings().not("select").slideDown("fast"),a.parents("form").find("#rentalRates").slideDown("fast"),a.parents("form").siblings().slideDown("fast"),a.siblings(".price").addClass("no-display"),$(".selectBox-container").css("overflow","visible")}),$("#quickView #rentalRates").on("change",function(){var a=$("option:selected",this).attr("data-rental-rate"),c=$("option:selected",this).attr("data-rental-return-date"),d=$("option:selected",this).attr("data-rental-discount"),e=b.find(".rental-price .current-price"),f=b.find(".return-date"),g=b.find(".rental-price .discount-amount-value");e.text(a),f.text(c),g.text(d)}),initImageSwitcher(),attachCartAction(!0),$("#quickView .prim-image a").attr("href",e),$("#quickView .prim-image a").bind("click",function(){window.location.href=$(this).attr("href")});var y=!1;if($("#quickView p.nook-devices-apps a").on("click",function(a){a.preventDefault(),b.find("#quickView .expand-cvv-container").toggle(),0==y?($("#quickView .nook-devices-apps .show img").attr("src","/static/img/sprites/tooltip-active.png"),$(this).addClass("open"),y=!0):($("#quickView .nook-devices-apps .show img").attr("src","/static/img/sprites/plus-expand.png"),$(this).removeClass("open"),y=!1)}),$("#quickView div.format-content a").attr("href",e),getThumbsCarousel(b),$("[data-tooltip-trigger]").length>0&&showTooltip(!0),$(".btn-goToEpisodes").length){var z=$("<div></div>");$.ajax({url:"/cartridges/ProductDetailContent/ProductDetailTypes/includes/episodes-list.jsp",cache:!1,type:"post",data:{eans:$("#dataEpisodes").attr("data-eans")}}).done(function(a){z.html(a),$("#lowestPriceEpisodeButton").text(z.find("#lowestPriceEpisode").attr("data-lowpriceepisode")),z.remove()})}a.addTabIndex(),a.initTabIndex(),a.initFocusImmediately();var A=$("#quickView form.ip-form");if(BN.uXHR.Form.apply(A),A.on("submit",function(){a.hideSpinner(),a.displaySpinner()}).on("amplifiFormSuccess",function(){}).on("amplifiFormBeforeSerialize",function(){A.find(".is-add-to-cart-ajax").remove(),A.append('<input type="hidden" name="isAjax" value="true" class="is-add-to-cart-ajax" />')}).on("amplifiFormError",function(b,c){a.hideSpinner(),!c.response.data.instantPurchaseError&&c.response.data.errors.length>0||new BN.Modal.Browse.PDP.InstantPurchase(null,c.response.data,c.response.data.tplParams)}),"undefined"!=typeof s_setP){var B=getAnalyticsEventCount(),C=b.find(".analytics-qv-data").text(),D=$.parseJSON(C)||{},E=b.find(".pdp-form .btn-addtocart");s_setP("digitalData.event["+B+"].eventInfo.eventName","prodQuickView"),attachDataToButton(C,E),$(document).triggerHandler("analytics-quick-view",{analytics:D}),A.on("amplifiFormSuccess",function(a){var b=$(this),c=b.closest(".multi-product-select,ul.subscriptions-container").length>0?!0:!1,d=c?"li":"#prodInfoContainer",e=b.parents(d).find(".pdp-form").not(":hidden")||b.siblings(".pdp-form").not(":hidden"),f={element:e,updateType:"add",addedFrom:"modal",isInstant:!0};analyticsShoppingCart(a,f)})}})})}},a}(),BN.Modal.Browse.Base,!0),BN.Modal.Browse=BN.Modal.Browse||{},BN.Modal.Browse.UsedGoodCondition=BN.Modal.Browse.UsedGoodCondition||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Browse.UsedGoodCondition")};return a.prototype={tplName:"m-usedgood-condition",defaultOptions:{useCache:!1,tplDir:SITE_ROOT+"/modals/textbook/"},initView:function(){var a=this.data,b=$(a.target),c=b.attr("href")||"";!a.redirectSuccessUrl&&b.length>-1&&""!=c&&"#"!=c&&("/"==c.substr(0,1)&&(c=SITE_DOMAIN_URL+c),consoleLog(c),a.redirectSuccessUrl=c),this.initGenericView(),this.initForm()}},a}(),BN.Modal.Browse.Base,!0);;/*! BARNES-BUILDER 2016-11-18 */
function checkPottermorePassthru(a,b){var c=window.open("about:blank","_blank");$.ajax({type:"POST",dataType:"json",url:"/util/setPottermorePassthru.jsp",data:{pottermoreFlag:a}}).done(function(){c&&(c.location.href=b)}).fail(function(){}).always(function(){})}BN.Modal.Browse.PDP=BN.Modal.Browse.PDP||{},BN.Modal.Browse.PDP.Base=BN.Modal.Browse.PDP.Base||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Browse.PDP.Base")};return a.prototype={},a}(),BN.Modal.Browse.Base,!0),BN.Modal.Browse.PDP=BN.Modal.Browse.PDP||{},BN.Modal.Browse.PDP.LexileMeasures=BN.Modal.Browse.PDP.LexileMeasures||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Browse.PDP.LexileMeasures")};return a.prototype={tplName:"m-lexile-measures",defaultOptions:{tplDir:SITE_ROOT+"/modals/"}},a}(),BN.Modal.Browse.PDP.Base,!0),BN.Modal.Browse.PDP=BN.Modal.Browse.PDP||{},BN.Modal.Browse.PDP.BuyEGift=BN.Modal.Browse.PDP.BuyEGift||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Browse.PDP.BuyEGift")};return a.prototype={tplName:"egift-purchase",initView:function(){this.initGenericView(),this.initForm(),this.on("display",function(){initializeTextAreaCounter($("textarea#egiftWrapMessage"),$(".limit-notifier")),initEGiftYear()}),$modal=$(this.modal),$giftInput=$modal.find("#eGiftDate"),$availableDate=""==$(".buy-as-egift").attr("data-available-date")?0:new Date($(".buy-as-egift").attr("data-available-date")),$giftInput.datepicker({showOn:"button",buttonImage:"/static/img/sprites/calendar-up.png",buttonImageOnly:!0,minDate:$availableDate,maxDate:"+1Y",showOn:"both",onClose:function(){var a=$giftInput.siblings(".ui-datepicker-trigger");a.attr("src","/static/img/sprites/calendar-up.png")},beforeShow:function(){var a=$giftInput.siblings(".ui-datepicker-trigger");a.attr("src","/static/img/sprites/calendar-down.png")}}).on("change",function(){var a=$giftInput.val().split("/");$modal.find("#eGiftMonth").val(a[0]),$modal.find("#eGiftDay").val(a[1]),$modal.find("#eGiftYear").val(a[2])})}},a}(),BN.Modal.Browse.PDP.Base,!0),BN.Modal.Browse.PDP=BN.Modal.Browse.PDP||{},BN.Modal.Browse.PDP.CvvCode=BN.Modal.Browse.PDP.CvvCode||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Browse.PDP.CvvCode")};return a.prototype={tplName:"cvvcode",defaultOptions:{tplDir:SITE_ROOT+"/modals/",tplExt:".jsp",css:!1,modalIsScrollable:!1,position:{center:!1,anchor:["target","bottom left"]},posBuffer:{anchor:{bottom:20,left:50}},overlayClose:"this",hideParent:!1,stackOverlay:!0},invisibleOverlay:!0,initView:function(){var a=($(this.modal),$(this.data.target));a.attr("data-icon","tooltip-active"),this.closeEvents.all.push(function(){a.attr("data-icon","plus-expand")})}},a}(),BN.Modal.Browse.PDP.Base,!0),BN.Modal.Browse.PDP=BN.Modal.Browse.PDP||{},BN.Modal.Browse.PDP.Duplicatesample=BN.Modal.Browse.PDP.Duplicatesample||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Browse.PDP.Duplicatesample")};return a.prototype={tplName:"m-duplicatesample",defaultOptions:{tplDir:SITE_ROOT+"/modals/"},initView:function(){var a=this;this.on("display",function(){$("#buySampleAsGift").click(function(){a.Close(),$(".buy-as-egift").click()})})}},a}(),BN.Modal.Browse.PDP.Base,!0),BN.Modal.Browse.PDP=BN.Modal.Browse.PDP||{},BN.Modal.Browse.PDP.eMagFreeTrial=BN.Modal.Browse.PDP.eMagFreeTrial||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Browse.PDP.eMagFreeTrial")};return a.prototype={tplName:"e-mag-trial"},a}(),BN.Modal.Browse.PDP.Base,!0),BN.Modal.Browse.PDP=BN.Modal.Browse.PDP||{},BN.Modal.Browse.PDP.eMagSubscription=BN.Modal.Browse.PDP.eMagSubscription||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Browse.PDP.eMagSubscription")};return a.prototype={tplName:"e-mag-subscr"},a}(),BN.Modal.Browse.PDP.Base,!0),BN.Modal.Browse=BN.Modal.Browse||{},BN.Modal.Browse.PDP.HowTextbookRentalsWork=BN.Modal.Browse.PDP.HowTextbookRentalsWork||Extend(function(){var a=function(a,b){this.data=b,consoleLog("Instantiating BN.Modal.Browse.PDP.HowTextbookRentalsWork")};return a.prototype={tplName:"how-textbook-rentals-work"},a}(),BN.Modal.Browse.PDP.Base,!0),BN.Modal.Browse.PDP=BN.Modal.Browse.PDP||{},BN.Modal.Browse.PDP.ImageViewer=BN.Modal.Browse.PDP.ImageViewer||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Browse.PDP.ImageViewer")};return a.prototype={tplName:"liquid-pixel-viewer.jsp",defaultOptions:{useCache:!1},initView:function(){var a=($(this.modal),[]),b=0;this.on("display",function(){function c(){$("#pdpZoomerImage").html(""),k=new com.liquidpixels.Zoom("pdpZoomerImage",{server:$("#pdpMainImage").closest("a").data("liquiddomain"),uri:"lf",height:600,width:595,image:a[b],maxZoom:3,stitched:!0,displayMode:"fit",handleZoomEvent:function(a,b){"loaded"===a&&b.atMinScale===!1&&$(document).triggerHandler("analytics-zoom-click")}})}$(".alt-views #thumbs img").each(function(){var b=$(this).attr("src").split(/_/);thumbLfPath=b[0].split(/\//)[3],thumbEan=b[0].split(/\//)[4],thumbEanPath=thumbEan.substring(thumbEan.length-4),thumbPosition=b[1],thumbType=b[3].split(/\./)[1],thumbLfImage="file:images/Images/"+thumbLfPath+"/"+thumbEanPath+"/"+thumbEan+"_"+thumbPosition+"."+thumbType,a.push(thumbLfImage)});var d=$("#pdpMainImage").attr("src").split(/_/),e=d[0].split(/\//)[3],f=d[0].split(/\//)[4],g=f.substring(f.length-4),h=d[1],i=d[3].split(/\./)[1],j="file:images/Images/"+e+"/"+g+"/"+f+"_"+h+"."+i,k=new com.liquidpixels.Zoom("pdpZoomerImage",{server:$("#pdpMainImage").closest("a").data("liquiddomain"),uri:"lf",height:600,width:595,image:j,maxZoom:3,stitched:!0,displayMode:"fit",handleZoomEvent:function(a,b){"loaded"===a&&b.atMinScale===!1&&$(document).triggerHandler("analytics-zoom-click")}});if(a.length>0){for(var l=0;l<a.length;l+=1)a[l]==j&&(b=l);$(".pdp-zoomer #prevImage").bind("click",function(){b--,0>b&&(b=a.length-1),c(b)}),$(".pdp-zoomer #nextImage").bind("click",function(){b++,b==a.length&&(b=0),c(b)})}else $(".pdp-zoomer #prevImage").css("visibility","hidden"),$(".pdp-zoomer #nextImage").css("visibility","hidden")})}},a}(),BN.Modal.Browse.PDP.Base,!0),BN.Modal.Browse.PDP=BN.Modal.Browse.PDP||{},BN.Modal.Browse.PDP.InstantPurchase=BN.Modal.Browse.PDP.InstantPurchase||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Browse.PDP.InstantPurchase")};return a.prototype={tplName:"instant-purchase",defaultOptions:{tplDir:SITE_ROOT+"/modals/checkout/",useCache:!1},initView:function(){var a=this,b=$(this.modal),c=this.data.instantPurchaseError,d="data.error-state",e=d+'[value="'+c+'"]',f=b.find("#requireCVV");if(b.find(e).length>0?b.find(d).not(e).remove():b.find(d).not(d+'[value="generic-error"]').remove(),"invalidAddress"==c){var g=b.find("#other-errors").find("ul");$.each(this.data.errors,function(a,b){g.append("<li>"+b+"</li>")}),g.closest("#other-errors").removeClass("no-display")}b.find("#ccCode").length>0&&$(".formCVVCode").attr("minLength",b.find("#ccCode").attr("maxLength")),b.find("#ccCode").on("keyup keydown keypress focusin focusout",function(){$(".formCVVCode").val($(this).val()),$(".formCVVCode").attr("minLength",b.find("#ccCode").attr("maxLength"))}),b.find(".btn-instant-purchase").on("click",function(b){b.preventDefault(),b.stopPropagation(),$(f).hide(),a.displaySpinner();var c=$("input.formCVVCode").attr("data-skuid")||a.data.instantPurchaseSkuId,d=$("input.formCVVCode").val(),e=$("input.formCVVCode").attr("minLength"),g=$('input[value="'+c+'"]').closest("form"),h=$('[data-modal-name="quickview"]').length>0,i=h?g.parents("#quickView").find(".btn-instant-purchase"):g.parents(".PageContent").find(".btn-instant-purchase"),j=/^\d+$/;return d.length<e||!j.test(d)?(a.hideSpinner(),$(f).html("The security code that you entered is not valid.  Please check your code and try again."),$(f).show(),void $("input.formCVVCode").val("")):(a.flow().get(0).Close(),$(".sign-in-instant-purchase").is(":visible")&&($(".sign-in-instant-purchase").hide(),i.removeClass("no-display")),void i.filter(":visible").click())}),b.find(".expand-cvv").on("click",function(){b.find(".expand-cvv-container").toggle(),b.find(".expand-cvv").toggleClass("expandicon-change")}),$(".pdp-errors").removeClass("display-error").empty()}},a}(),BN.Modal.Browse.PDP.Base,!0),BN.Modal.Browse.PDP=BN.Modal.Browse.PDP||{},BN.Modal.Browse.PDP.LearnBuyRent=BN.Modal.Browse.PDP.LearnBuyRent||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Browse.PDP.LearnBuyRent")};return a.prototype={tplName:"m-learn-buy-rent",defaultOptions:{tplDir:SITE_ROOT+"/modals/"}},a}(),BN.Modal.Browse.PDP.Base,!0),BN.Modal.Browse.PDP=BN.Modal.Browse.PDP||{},BN.Modal.Browse.PDP.LendMe=BN.Modal.Browse.PDP.LendMe||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Browse.PDP.LendMe")};return a.prototype={tplName:"lendme"},a}(),BN.Modal.Browse.PDP.Base,!0),BN.Modal.Browse.PDP=BN.Modal.Browse.PDP||{},BN.Modal.Browse.PDP.Audio=BN.Modal.Browse.PDP.Audio||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Browse.PDP.Audio")};return a.prototype={tplName:"video-player",initView:function(){var a=this.data,b=$(this.modal),c=$(a.target),d=c.attr("href")||"",e=b.find("#dialog-title"),f=c.text(),g=$("<iframe />",{name:"audioClipFrame",id:"audioClipFrame",src:d});e.html(f?f:"&nbsp;"),b.find(".embed-container").html(g)}},a}(),BN.Modal.Browse.PDP.Base,!0),BN.Modal.Browse.PDP=BN.Modal.Browse.PDP||{},BN.Modal.Browse.PDP.AddToBag=BN.Modal.Browse.PDP.AddToBag||Extend(function(){var a=function(a,b){this.data=b,consoleLog("Instantiating BN.Modal.AddToBag")};return a.prototype={tplName:"m-add-to-bag",initView:function(){var a=this.data,b=$(this.modal);if(consoleLog("closeEvents for AddToBag modal = ",this.closeEvents),a&&(a.title&&"string"==typeof a.title&&b.find("#dialog-title").text(a.title),a.onClose&&this.closeEvents.all.push(a.onClose),a.messages)){var c=Modal.prototype.openModals;if(c)for(var d in c){var e=c[d];e&&e.Close&&e.Close()}}}},a}(),BN.Modal.Browse.PDP.Base,!0),BN.Modal.Browse.PDP=BN.Modal.Browse.PDP||{},BN.Modal.Browse.PDP.PottermoreBuy=BN.Modal.Browse.PDP.PottermoreBuy||Extend(function(){var a=function(a,b){consoleLog("Instantiating BN.Modal.Browse.PDP.PottermoreBuy"),this.options.tplParams={pottermoreUrl:encodeURIComponent($(b.target).attr("href")),pottermoreEan:$(b.target).attr("id")},this.Display()};return a.prototype={defaultOptions:{autoDisplay:!1,tplDir:SITE_ROOT+"/modals/nook/"},tplName:"pottermore_buy_window"},a}(),BN.Modal.Browse.PDP.Base,"before"),BN.Modal.Browse.PDP=BN.Modal.Browse.PDP||{},BN.Modal.Browse.PDP.Promise=BN.Modal.Browse.PDP.Promise||Extend(function(){var a=function(a,b){this.data=b,consoleLog("Instantiating BN.Modal.Browse.PDP.Promise")};return a.prototype={defaultOptions:{tplDir:SITE_ROOT+"/modals/checkout/"},tplName:"delivery-promise"},a}(),BN.Modal.Browse.PDP.Base,!0),BN.Modal.Browse=BN.Modal.Browse||{},BN.Modal.Browse.PDP.RentalTOU=BN.Modal.Browse.PDP.RentalTOU||Extend(function(){var a=function(a,b){this.data=b,consoleLog("Instantiating BN.Modal.Browse.PDP.RentalTOU")};return a.prototype={tplName:"rental-terms-of-use"},a}(),BN.Modal.Browse.PDP.Base,!0),BN.Modal.Browse=BN.Modal.Browse||{},BN.Modal.Browse.PDP.Reserve=BN.Modal.Browse.PDP.Reserve||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Browse.PDP.Reserve")};return a.prototype={tplName:"puis",initView:function(){var a=$(this.parent.modal),b=$(this.modal),c=this,d=this.flow().get("quickview"),e=Date.now(),f=$("#skuSelection").find('[name^="/"][name*="catalogRefIds"]').val(),g=a.find('[name="zip"]').val();if(f=void 0===f||""==f?getQueryParameterByName("ean"):f,$("body.account.wishlist").length>0)var h=$(this.parent.data.target).parents(".bag-info"),f=h.find('[name="wishlistForm"] [name^="/"][name*="catalogRefIds"]').val();this.displaySpinner(),BN.uXHR.getService("puis",{time:e,ean:f,zipcode:g},function(a){b.find("iframe").attr("src",a.service.endpointUrl),c.hideSpinner()}),this.initPostMessageListener(),this.closeEvents.all.push(function(){c.removePostMessageListener()}),d&&d.hide()},initPostMessageListener:function(){var a=this;this.postMessageListener=function(b){var c=b.originalEvent.data;if("closeModal"===c&&a.Close(),c&&c.type&&c.revenue&&c.quantity&&"reserveInStoreSuccess"===c.type){var d=c.revenue,e=c.quantity;"undefined"!=typeof s_setP&&trackReserveInStore(d,e)}},$(window).on("message",this.postMessageListener)},removePostMessageListener:function(){$(window).off("message",this.postMessageListener)},postMessageListener:function(){}},a}(),BN.Modal.Base),BN.Modal.Browse=BN.Modal.Browse||{},BN.Modal.Browse.PDP.ReserveTT=BN.Modal.Browse.PDP.ReserveTT||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Browse.PDP.ReserveTT"),this.originClass.apply(this,arguments)};return a.prototype={tplName:"puis-tooltip",defaultOptions:{css:!1,modalIsScrollable:!1,position:{center:!1,anchor:["target","bottom center"]},posBuffer:{anchor:20},hideParent:!1},invisibleOverlay:!0,initView:function(){var a=this,b=$(this.modal),c=this.parent,d=c&&"BN.Modal.Browse.Quickview"===c.data["modal-class"]?!0:!1;b.find("form").on("submit",function(b){b.preventDefault(),a.displaySpinner()});var e=204,f=20,g=$(this.data.target).offset(),h=g.top,i=h-(e+f)+"px";b.css("top",i),this.on("display",function(){(""!=data["modal-postalcode"]||"undefined"!=data["modal-postalcode"])&&b.find(".inp-marg").val(data["modal-postalcode"]),d&&(b.css("position","fixed"),b.find("a[data-close]").attr("data-close","this"))})}},a}(),BN.Modal.Base,!1),BN.Modal.Browse.PDP=BN.Modal.Browse.PDP||{},BN.Modal.Browse.PDP.Sampleadded=BN.Modal.Browse.PDP.Sampleadded||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Browse.PDP.Sampleadded")};return a.prototype={tplName:"m-sampleadded",defaultOptions:{tplDir:SITE_ROOT+"/modals/"}},a}(),BN.Modal.Browse.PDP.Base,!0),BN.Modal.Browse=BN.Modal.Browse||{},BN.Modal.Browse.PDP.TextbookRentalFAQ=BN.Modal.Browse.PDP.TextbookRentalFAQ||Extend(function(){var a=function(a,b){this.data=b,consoleLog("Instantiating BN.Modal.Browse.PDP.TextbookRentalFAQ")};return a.prototype={tplName:"rentals-faq"},a}(),BN.Modal.Browse.PDP.Base,!0),BN.Modal.Browse.PDP=BN.Modal.Browse.PDP||{},BN.Modal.Browse.PDP.Ultraviolet=BN.Modal.Browse.PDP.Ultraviolet||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Browse.PDP.Ultraviolet")};return a.prototype={tplName:"m-ultraviolet",defaultOptions:{tplDir:SITE_ROOT+"/modals/"},initView:function(){}},a}(),BN.Modal.Browse.PDP.Base,!0),BN.Modal.Browse.PDP=BN.Modal.Browse.PDP||{},BN.Modal.Browse.PDP.UpgradeSubscription=BN.Modal.Browse.PDP.UpgradeSubscription||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Browse.PDP.UpgradeSubscription")};return a.prototype={tplName:"e-mag-how"},a}(),BN.Modal.Browse.PDP.Base,!0),BN.Modal.Browse.PDP=BN.Modal.Browse.PDP||{},BN.Modal.Browse.PDP.UltravioletSignIn=BN.Modal.Browse.PDP.UltravioletSignIn||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Browse.PDP.Ultraviolet")};return a.prototype={tplName:"m-uv-signin-form",defaultOptions:{tplDir:SITE_ROOT+"/modals/"},initView:function(){}},a}(),BN.Modal.Browse.PDP.Base,!0),BN.Modal.Browse.PDP=BN.Modal.Browse.PDP||{},BN.Modal.Browse.PDP.Video=BN.Modal.Browse.PDP.Video||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Browse.PDP.Video")};return a.prototype={tplName:"video-player",_isHTML5VideoSupported:function(){var a=!1,b=document.createElement("video");return b&&"function"==typeof b.canPlayType&&(a=!0),a},_isVideoCodecSupported:function(){var a=!1,b=document.createElement("video");return b&&"function"==typeof b.canPlayType&&(b.canPlayType('video/mp4; codecs="avc1.42E01E"')||b.canPlayType('video/mp4; codecs="avc1.42E01E, mp4a.40.2"'))&&(a=!0),a},_tokenizeTemplate:function(a,b){var c=a,d=null,e=null;for(d in b)b.hasOwnProperty(d)&&(e=new RegExp("%"+d+"%","g"),c=c.replace(e,b[d]));return c},_flashEmbedKitDigitalPlayer:function(a){var b=a.stem,c=a.assetId,d="",e="",f="&autoPlay=true&revision=1&scaleMODE=letterbox&width="+a.width+"&height="+a.height,g="";return b?(d="/mediasuite_3732/AppShell_lu8l0r86.swf",g=b+c,e="mediaURL="+g+f):(d="/mediasuite_3732/AppShell_lu8l0r86.swf",e="mediaSuiteURL=http://player.multicastmedia.com/ws/get_asset_project/asset/"+c+"/stream/api_f4d84551-2e85-103a-a1ba-00e08655b9fc/apiv_3.5/gft_0/"+c+".xml"+f+"&getEmbed=http://mediasuite.multicastmedia.com/ws/get_appstudio_embed/v1/vodproject/project_uuid/kvv27swx.xml&src=http://api.mediasuite.multicastmedia.com/templates/AppStudio/CustomPlayer/3/7/3732/lu8l0r86/lu8l0r86.json&"),this._tokenizeTemplate(a.objtemplate,{WIDTH:a.width,HEIGHT:a.height,PLAYERID:d,FLASHVARS:e})},_html5VideoPlayerTag:function(a){var b="",c="",d=a.stem;return d&&(c=d+a.assetId,b=this._tokenizeTemplate(a.html5template,{WIDTH:a.width,HEIGHT:a.height,VIDEOURL:decodeURIComponent(c)})),b},_kitDigitalPlayerIframe:function(a){var b="",c="",d="",e="&autoPlay=true&revision=1&scaleMODE=letterbox&width="+a.width+"&height="+a.height;return urlEscapeFn=encodeURIComponent,assetId=a.assetId,stem=a.stem,stem?c="mediaUrl="+(stem+assetId)+e:(d="http://player.multicastmedia.com/ws/get_asset_project/asset/"+assetId+"/stream/api_f4d84551-2e85-103a-a1ba-00e08655b9fc/apiv_3.5/gft_0/"+assetId+".xml",c="mediaSuiteURL="+urlEscapeFn(d)+e+"&getEmbed="+urlEscapeFn("http://mediasuite.multicastmedia.com/ws/get_appstudio_embed/v1/vodproject/project_uuid/kvv27swx.xml")+"&widgetId=lu8l0r86&widgetHost=www.appstudio.piksel.com&src="+urlEscapeFn("http://player.multicastmedia.com/ws/get_appstudio_player_json/callback/KickUtils.scriptLoadCallbacks[0]/lu8l0r86.json")),b='<iframe src="http://www.appstudio.piksel.com/kickFlash/js/compiler/mediasuite/iframe.html?affiliateSiteId=mediasuite_73&'+c+"&referralUrl="+urlEscapeFn(window.location.href)+'" height="'+a.height+'" width="'+a.width+'" frameborder="0" scrolling="no"style="border:none;overflow:hidden;width:'+a.width+"px;height:"+a.height+'px"></iframe>'},initView:function(){var a=$(this.modal),b=a.find("#dialog-title"),c=$(this.data.target).attr("data-media-title"),d=this._isHTML5VideoSupported(),e=this._isVideoCodecSupported(),f={"default-default":{width:"608",height:"379",source:"default",padx:20,pady:20,objtemplate:'<object type="application/x-shockwave-flash" id="mediasuite_Appstudio_231743" data="http://appasset.appstudio.piksel.com/compiled%PLAYERID%" width="%WIDTH%" height="%HEIGHT%" ><param name="movie" value="http://appasset.appstudio.piksel.com/compiled%PLAYERID%"> </param><param name="pluginspage" value="http://www.adobe.com/go/getflashplayer"> </param><param name="align" value="middle"> </param><param name="allowscriptAccess" value="always"> </param><param name="quality" value="high"> </param><param name="allowFullScreen" value="true"> </param><param name="wmode" value="transparent"> </param><param name="bgcolor" value="#FFFFFF"> </param><param name="menu" value="false"> </param><param name="FlashVars" value="%FLASHVARS%"></param></object>',html5template:'<video id="videoplayer" width="%WIDTH%" height="%HEIGHT%" controls preload="none"><!-- MP4 must be first for iPad! --><source src="%VIDEOURL%" type="video/mp4" /><!-- WebKit video --></video>'},"ooyala-default":{width:"800",height:"534",padx:20,pady:14,source:"ooyala",objtemplate:"http://player.ooyala.com/player.js?playerId=ooplayerdiv&playerContainerId=ooplayer%ASSETID%&width=%WIDTH%&height=%HEIGHT%&embedCode=%ASSETID%&version=2",pcode:"43Y3Y6G5cQeLfnCyD655LkR7eFC9"},"ooyala-wide":{width:"800",height:"534",padx:14,pady:98,source:"ooyala",objtemplate:"http://player.ooyala.com/player.js?playerId=ooplayerdiv&playerContainerId=ooplayer%ASSETID%&width=%WIDTH%&height=%HEIGHT%&embedCode=%ASSETID%&version=2",pcode:"43Y3Y6G5cQeLfnCyD655LkR7eFC9"},"ooyala-tall":{width:"336",height:"575",padx:14,pady:98,source:"ooyala",objtemplate:"http://player.ooyala.com/player.js?playerId=ooplayerdiv&playerContainerId=ooplayer%ASSETID%&width=%WIDTH%&height=%HEIGHT%&embedCode=%ASSETID%&version=2",pcode:"43Y3Y6G5cQeLfnCyD655LkR7eFC9"}},g=$(this.data.target).attr("data-media-stem"),h=$(this.data.target).attr("data-asset-id"),i=$(this.data.target).attr("data-asset-source"),j=$(this.data.target).attr("data-asset-skin"),k="",i=null===i||""===i?"default":i,j=null!==j&&""!==j?j:"default",l=null!==j&&""!==j?i+"-"+j:i;g=encodeURIComponent(g).replace(/'/g,"%27").replace(/"/g,"%22");var m={};m.assetId=h,m.source=f[l].source,m.stem=g,m.css_prefix=l,m.padx=f[l].padx,m.pady=f[l].pady,m.width=f[l].width,m.height=f[l].height,m.skin=j,m.objtemplate=f[l].objtemplate,m.html5template=f[l].html5template,m.pcode=f[l].pcode,this.on("display",function(){b.html(c?c:"&nbsp;"),k=d&&e?m.stem?this._html5VideoPlayerTag(m):FlashDetect.versionAtLeast(10,0,0)?this._flashEmbedKitDigitalPlayer(m):this._kitDigitalPlayerIframe(m):FlashDetect.versionAtLeast(10,0,0)?this._flashEmbedKitDigitalPlayer(m):'<h2>This player requires either Flash or HTML5.</h2><p>Please download <a href="http://get.adobe.com/flashplayer/" alt="Adobe Flash Player" target="_blank">Flash Player</a> or upgrade your browser to support HTML5 H.264 videos.</p>',a.find(".embed-container").append(k);var f=$("#videoplayer"),g=0,h=c||"No title";"undefined"!=typeof s_setP&&($("#videoplayer").on("ended",function(){trackVideo("endVideo",h)}),$("#videoplayer").on("play",function(){1>g&&trackVideo("startVideo",h),g++})),f.play()})}},a}(),BN.Modal.Browse.PDP.Base,!0);;/*! BARNES-BUILDER 2016-11-18 */
BN.Modal.Gigya=BN.Modal.Gigya||{},BN.Modal.Gigya.Base=BN.Modal.Gigya.Base||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Browse.Base")};return a.prototype={defaultOptions:{tplDir:SITE_ROOT+"/modals/gigya/"}},a}(),BN.Modal.Base,!0),BN.Modal.Gigya=BN.Modal.Gigya||{},BN.Modal.Gigya.ReviewGuidelines=BN.Modal.Gigya.ReviewGuidelines||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Gigya.ReviewGuidelines")};return a.prototype={tplName:"review-guidline",initView:function(){this.data;this.initGenericView(),this.initForm()}},a}(),BN.Modal.Gigya.Base,!0),BN.Modal.Gigya=BN.Modal.Gigya||{},BN.Modal.Gigya.WriteReview=BN.Modal.Gigya.WriteReview||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Browse.writeReview")};return a.prototype={tplName:"writeReview",initFocusSelector:"textarea#comment-text",initView:function(){var a=this,b="Products",c=a.data["work-id"],d=a.data.uid,e=a.data.ean;this.displaySpinner(),this.on("display",function(){function f(b,d){if(void 0!=d.ratings||""!=d.commentText){var f={action:"customer-product-review-submitted",ean:e,work_id:c,review_text:d.commentText,rating:d.ratings};makeBnLoggingCall(f,{requestType:"post"})}0==b.errorCode?(a.Close(),new BN.Modal.Success(null,{title:"Success!",messages:[{type:"success",message:"Your review has been submitted."}],onclose:function(){window.location.reload(!0)}}),$(document).triggerHandler("analytics-track-review")):400002==b.errorCode||400006==b.errorCode?($(".wr-error").css("display","block").focus(),$(".errmsg").html("Please select a rating"),a.$spinner.remove()):403037==b.errorCode?($(".wr-error").css("display","block").focus(),$(".errmsg").html("This product has already been reviewed"),a.$spinner.remove()):($(".wr-error").css("display","block").focus(),$(".errmsg").html(b.errorDetails),a.$spinner.remove())}function g(a){var g=$(".review-textarea").val(),h=g.length>70?g.substring(0,66)+" ...":g,i=$('input[name="rating"]:checked').val(),j=$("#prodSummary h1").html(),k=window.location.href,l=$("#leaveAnonymousReview").prop("checked"),m={ratings:i,commentText:g};if(postParams={categoryID:b,streamID:c,commentTitle:h,commentText:g,ratings:{_overall:i},UID:d,anonymous:l,tags:[e],callback:function(a){f(a,m)}},0==a.streamInfo.commentCount){var n={categoryID:b,streamID:c,streamTitle:j,streamURL:k};gigya.comments.setStreamInfo(n)}gigya.comments.postComment(postParams)}a.$spinner.remove();var h="",i=$('input[name="rating"]');i.on("change",function(){var a=$(this),b=a.attr("id"),c=i.siblings(".styled-radio");radioIndex=b.substr(b.length-1);for(var d=0;5>d;d++)c.eq(d).removeClass("styled-radio-full"),radioIndex>d&&c.eq(d).addClass("styled-radio-full")}),$(".styled-radio").on("mouseenter",function(a){a.preventDefault(),$(".rating-msg-pop").show();var b=a.target,c=b.getAttribute("data-value");1==c?(h="Poor",$(".rating-msg-pop").css("left","85px"),$(".rating-msg-pop .triangle-up").css("left","5px"),$(".rating-msg-pop p").text(h)):2==c?(h="Below Average",$(".rating-msg-pop").css("left","82px"),$(".rating-msg-pop .triangle-up").css("left","33px"),$(".rating-msg-pop p").text(h)):3==c?(h="Good",$(".rating-msg-pop").css("left","131px"),$(".rating-msg-pop .triangle-up").css("left","7px"),$(".rating-msg-pop p").text(h)):4==c?(h="Very good ",$(".rating-msg-pop").css("left","142px"),$(".rating-msg-pop .triangle-up").css("left","20px"),$(".rating-msg-pop p").text(h)):5==c&&(h="Excellent",$(".rating-msg-pop").css("left","168px"),$(".rating-msg-pop .triangle-up").css("left","18px"),$(".rating-msg-pop p").text(h))}).on("mouseleave",function(){$(".rating-msg-pop").hide()}),initializeTextAreaCounter($(".review-textarea"),$(".limit-notifier")),$("#postReview").on("click",function(a){a.preventDefault();var d={categoryID:b,streamID:c,callback:g};"undefined"!=typeof gigya&&gigya.comments.getStreamInfo(d)}),$(a.modal).on("click","#cancelReview",function(b){b.preventDefault(),a.Close()}),$(a.modal).on("click","#checkPenNameModal",function(b){b.preventDefault(),new BN.Modal.Gigya.CheckPenName(null,null,{},a)}),$(a.modal).on("click",".review-guidelines-link",function(b){b.preventDefault(),new BN.Modal.Gigya.ReviewGuidelines(null,null,{},a)})})}},a}(),BN.Modal.Gigya.Base,!0),BN.Modal.Gigya.CheckPenName=BN.Modal.Gigya.CheckPenName||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Gigya.CheckPenName")};return a.prototype={tplName:"check-pen-name",initView:function(){var a=$(this.modal),b=a.find("form"),c=this;a.find(".pen-name-req-info").on("click",function(){$(this).hasClass("expandicon-change")?($(".pen-name-req-info-container").hide(),$(this).removeClass("expandicon-change")):($(".pen-name-req-info-container").show(),$(this).addClass("expandicon-change"))}),a.find(".continue-as-anonymous").on("click",function(){$("#leaveAnonymousReview").prop("checked",!0)}),this.initForm(!1),b.on("amplifiFormSuccess",function(){c.hideSpinner(),new BN.Modal.Gigya.SavePenName(null,null,{tplParams:{penName:$("input#penName").val()}},c)})}},a}(),BN.Modal.Gigya.Base,!0),BN.Modal.Gigya.SavePenName=BN.Modal.Gigya.SavePenName||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Gigya.SavePenName")};return a.prototype={tplName:"save-pen-name",initView:function(){var a=$(this.modal),b=a.find("form"),c=this;a.find(".continue-as-anonymous").on("click",function(){$("#leaveAnonymousReview").prop("checked",!0),c.flow().goTo(0)}),this.initForm(!1),b.on("amplifiFormSuccess",function(){c.hideSpinner(),$("#leaveAnonymousReview").prop("checked",!1),$("#userPenNameText").text($("#newPenName").val()),c.flow().goTo(0)})}},a}(),BN.Modal.Gigya.Base,!0);;/*! BARNES-BUILDER 2016-11-18 */
BN.Modal.Newsletter=BN.Modal.Newsletter||{},BN.Modal.Newsletter.Base=BN.Modal.Newsletter.Base||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Newsletter.Base")};return a.prototype={defaultOptions:{tplDir:SITE_ROOT+"/modals/newsletter/"},tplName:"newsletter",initView:function(){var a=this.data,b=this,c=$(this.modal),d=c.find("form");a.description&&"string"==typeof a.description&&c.find("h2").html(a.description),a.footerNote&&"string"==typeof a.footerNote&&c.find(".newsletter-modal__footnote").html(a.footerNote),BN.Validate.Listen(d),BN.uXHR.Form.apply(d),d.on("amplifiFormSuccess",function(){new BN.Modal.NewsletterSuccess.Base(null,{successMsg:a.successMsg},null,null),$(document).trigger("analytics-email-signup"),b.Close()}).on("amplifiFormError",function(a,b,c,e,f){var g=f.items;BN.Validate.DisplayErrors(this,g),d.find("input[type=text]").addClass("user-error")}).on("amplifiFormBeforeSubmit",function(){d.find("input[type=text]").removeClass("user-error")})}},a}(),BN.Modal.Base,!0),BN.Modal.NewsletterSuccess=BN.Modal.NewsletterSuccess||{},BN.Modal.NewsletterSuccess.Base=BN.Modal.NewsletterSuccess.Base||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.NewsletterSuccess.Base")};return a.prototype={defaultOptions:{tplDir:SITE_ROOT+"/modals/newsletter/"},tplName:"thank-you",initView:function(){var a=this.data,b=$(this.modal);a.successMsg&&"string"==typeof a.successMsg&&b.find("h2").html(a.successMsg)}},a}(),BN.Modal.Base,!0);